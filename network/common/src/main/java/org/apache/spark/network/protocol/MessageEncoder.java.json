[{
  "comments": [{
    "author": {
      "login": "JoshRosen"
    },
    "body": "I realized that this is slightly wrong: we assume that `in.body()` has a ref count of at least one when it's passed in and ownership of that reference is transferred to this method.\n\nTherefore, we should not add an extra retain here. In order to fix tests, though, I need to add a missing retain to ensure that the message passed in here has a non-zero ref. count for its inner Netty buffer.\n",
    "commit": "014ca9be204edb9428fae569921571012d3fdbde",
    "createdAt": "2016-02-13T22:17:22Z",
    "diffHunk": "@@ -49,11 +49,15 @@ public void encode(ChannelHandlerContext ctx, Message in, List<Object> out) thro\n \n     // If the message has a body, take it out to enable zero-copy transfer for the payload.\n     if (in.body() != null) {\n+      bodyLength = in.body().size();\n+      if (bodyLength > 0) {\n+        in.body().retain();"
  }],
  "prId": 11193
}]