[{
  "comments": [{
    "author": {
      "login": "colorant"
    },
    "body": "So, SPARK_PUBLIC_DNS is used to set worker's hostname, then do we need this umount /etc/hosts ? it seems to me in my env, it doesn't help with the hostname. the host name still keep to be the container's ID\n",
    "commit": "5d7a72ad30565281fb67f83b28827096b63f8d5b",
    "createdAt": "2014-02-27T01:24:58Z",
    "diffHunk": "@@ -19,4 +19,10 @@\n \n IP=$(ip -o -4 addr list eth0 | perl -n -e 'if (m{inet\\s([\\d\\.]+)\\/\\d+\\s}xms) { print $1 }')\n echo \"CONTAINER_IP=$IP\"\n-/opt/spark/spark-class org.apache.spark.deploy.master.Master -i $IP\n+export SPARK_LOCAL_IP=$IP\n+export SPARK_PUBLIC_DNS=$IP\n+\n+# Avoid the default Docker behavior of mapping our IP address to an unreachable host name\n+umount /etc/hosts\n+",
    "line": 10
  }, {
    "author": {
      "login": "aarondav"
    },
    "body": "Right, SPARK_PUBLIC_DNS does not actually change the Akka hostname, it only changes the name we tell the user to use to access the master/worker, which is better than nothing. \n\nThe actual hostname used by the Worker's Akka is specified in `org.apache.spark.util.Utils.localIpAddressHostname`, which unfortunately calls `InetAddress.getByName(address)`, transmuting the ip address into the container's ID as long as the /etc/hosts file exists. There is no current way to circumvent this behavior (there is a `Utils.setCustomHostname`, but it is only for testing purposes and cannot be specified by a configuration variable).\n",
    "commit": "5d7a72ad30565281fb67f83b28827096b63f8d5b",
    "createdAt": "2014-02-27T01:57:22Z",
    "diffHunk": "@@ -19,4 +19,10 @@\n \n IP=$(ip -o -4 addr list eth0 | perl -n -e 'if (m{inet\\s([\\d\\.]+)\\/\\d+\\s}xms) { print $1 }')\n echo \"CONTAINER_IP=$IP\"\n-/opt/spark/spark-class org.apache.spark.deploy.master.Master -i $IP\n+export SPARK_LOCAL_IP=$IP\n+export SPARK_PUBLIC_DNS=$IP\n+\n+# Avoid the default Docker behavior of mapping our IP address to an unreachable host name\n+umount /etc/hosts\n+",
    "line": 10
  }],
  "prId": 5
}]