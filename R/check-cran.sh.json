[{
  "comments": [{
    "author": {
      "login": "shivaram"
    },
    "body": "So I ran into a problem while trying to run this locally. It seems to be getting `SPARK_HOME` wrong for some reason\n\n```\n./R/check-cran.sh: line 45: /Users/shivaram/spark-1/R/bin/load-spark-env.sh: No such file or directory\n```\n",
    "commit": "1681005b6fe237d931fcea3daeaed3cb8c6087a1",
    "createdAt": "2016-11-10T18:17:27Z",
    "diffHunk": "@@ -36,11 +36,27 @@ if [ ! -z \"$R_HOME\" ]\n fi\n echo \"USING R_HOME = $R_HOME\"\n \n-# Build the latest docs\n-$FWDIR/create-docs.sh\n+# Build the latest docs, but not vignettes, which is built with the package next\n+NO_VIGNETTES=1 $FWDIR/create-docs.sh\n \n-# Build a zip file containing the source package\n-\"$R_SCRIPT_PATH/\"R CMD build $FWDIR/pkg\n+# Build source package with vignettes\n+SPARK_HOME=\"$(cd \"`dirname \"$0\"`\"/..; pwd)\""
  }, {
    "author": {
      "login": "felixcheung"
    },
    "body": "that's odd, it works in my environment.\ndo you happen to have check-cran.sh under a subdirectory of R?\n\nthis is the code:\n\n```\nSPARK_HOME=\"$(cd \"`dirname \"$0\"`\"/..; pwd)\"\n. \"${SPARK_HOME}\"/bin/load-spark-env.sh\n```\n\nso for /opt/spark/R/check-cran.sh, it should look for /opt/spark/bin/load-spark-env.sh\nand SPARK_HOME should be /opt/spark\n",
    "commit": "1681005b6fe237d931fcea3daeaed3cb8c6087a1",
    "createdAt": "2016-11-10T22:31:44Z",
    "diffHunk": "@@ -36,11 +36,27 @@ if [ ! -z \"$R_HOME\" ]\n fi\n echo \"USING R_HOME = $R_HOME\"\n \n-# Build the latest docs\n-$FWDIR/create-docs.sh\n+# Build the latest docs, but not vignettes, which is built with the package next\n+NO_VIGNETTES=1 $FWDIR/create-docs.sh\n \n-# Build a zip file containing the source package\n-\"$R_SCRIPT_PATH/\"R CMD build $FWDIR/pkg\n+# Build source package with vignettes\n+SPARK_HOME=\"$(cd \"`dirname \"$0\"`\"/..; pwd)\""
  }, {
    "author": {
      "login": "shivaram"
    },
    "body": "So I think this needs to be at the top of the file - The current working directory is probably changed in the middle by `create-docs.sh` or the `pushd $FWDIR`  ? \n",
    "commit": "1681005b6fe237d931fcea3daeaed3cb8c6087a1",
    "createdAt": "2016-11-10T22:56:22Z",
    "diffHunk": "@@ -36,11 +36,27 @@ if [ ! -z \"$R_HOME\" ]\n fi\n echo \"USING R_HOME = $R_HOME\"\n \n-# Build the latest docs\n-$FWDIR/create-docs.sh\n+# Build the latest docs, but not vignettes, which is built with the package next\n+NO_VIGNETTES=1 $FWDIR/create-docs.sh\n \n-# Build a zip file containing the source package\n-\"$R_SCRIPT_PATH/\"R CMD build $FWDIR/pkg\n+# Build source package with vignettes\n+SPARK_HOME=\"$(cd \"`dirname \"$0\"`\"/..; pwd)\""
  }, {
    "author": {
      "login": "felixcheung"
    },
    "body": "what that command is doing is\n1. get the dirname of the currently running file, check-cran.sh (`dirname \"$0\"`)\n2. cd to one level up (`cd x/..`)\n3. print current directory `pwd`\n4. set that to SPARK_HOME\n\nso it shouldn't matter what the current directory is but only with where the check-cran.sh is found?\n\nI'm running this on Ubuntu, it's possible if you are running on Mac the behavior is different somehow?\n",
    "commit": "1681005b6fe237d931fcea3daeaed3cb8c6087a1",
    "createdAt": "2016-11-10T23:22:28Z",
    "diffHunk": "@@ -36,11 +36,27 @@ if [ ! -z \"$R_HOME\" ]\n fi\n echo \"USING R_HOME = $R_HOME\"\n \n-# Build the latest docs\n-$FWDIR/create-docs.sh\n+# Build the latest docs, but not vignettes, which is built with the package next\n+NO_VIGNETTES=1 $FWDIR/create-docs.sh\n \n-# Build a zip file containing the source package\n-\"$R_SCRIPT_PATH/\"R CMD build $FWDIR/pkg\n+# Build source package with vignettes\n+SPARK_HOME=\"$(cd \"`dirname \"$0\"`\"/..; pwd)\""
  }, {
    "author": {
      "login": "shivaram"
    },
    "body": "Yeah I think the problem might be related to how you invoke it. If you invoke the script with an absolute path say `/Users/shivaram/spark-1/R/check-cran.sh` then the existing code works fine. If I however use a relative path -- for example `./R/check-cran.sh` while I am in `/Users/shivaram/spark-1` then it doesn't work. \n\nI think moving it to the top of the file is probably a good idea because the `$0` is relative to where the script started from and when we do `pushd $FWDIR` the working directory changes.\n",
    "commit": "1681005b6fe237d931fcea3daeaed3cb8c6087a1",
    "createdAt": "2016-11-10T23:27:55Z",
    "diffHunk": "@@ -36,11 +36,27 @@ if [ ! -z \"$R_HOME\" ]\n fi\n echo \"USING R_HOME = $R_HOME\"\n \n-# Build the latest docs\n-$FWDIR/create-docs.sh\n+# Build the latest docs, but not vignettes, which is built with the package next\n+NO_VIGNETTES=1 $FWDIR/create-docs.sh\n \n-# Build a zip file containing the source package\n-\"$R_SCRIPT_PATH/\"R CMD build $FWDIR/pkg\n+# Build source package with vignettes\n+SPARK_HOME=\"$(cd \"`dirname \"$0\"`\"/..; pwd)\""
  }, {
    "author": {
      "login": "felixcheung"
    },
    "body": "interesting. I changed this up a bit, not sure if it helps but both works on my setup\n",
    "commit": "1681005b6fe237d931fcea3daeaed3cb8c6087a1",
    "createdAt": "2016-11-10T23:35:30Z",
    "diffHunk": "@@ -36,11 +36,27 @@ if [ ! -z \"$R_HOME\" ]\n fi\n echo \"USING R_HOME = $R_HOME\"\n \n-# Build the latest docs\n-$FWDIR/create-docs.sh\n+# Build the latest docs, but not vignettes, which is built with the package next\n+NO_VIGNETTES=1 $FWDIR/create-docs.sh\n \n-# Build a zip file containing the source package\n-\"$R_SCRIPT_PATH/\"R CMD build $FWDIR/pkg\n+# Build source package with vignettes\n+SPARK_HOME=\"$(cd \"`dirname \"$0\"`\"/..; pwd)\""
  }],
  "prId": 15790
}]