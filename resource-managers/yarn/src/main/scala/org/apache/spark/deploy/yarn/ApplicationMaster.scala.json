[{
  "comments": [{
    "author": {
      "login": "vanzin"
    },
    "body": "This doesn't work; because you're using `send`, the handler would have to be in the `receive` method of the endpoint, and it's actually in `receiveAndReply` (which is the handler for `ask`).\r\n\r\nYou have to call `requestTotalExecutorsWithPreferredLocalities` directly here, or make that method take a `RequestExecutors` message as an argument, but you shouldn't go through the RPC system just to make a method call.",
    "commit": "45aac34d312bd80d4e67ab41939cebca8164868b",
    "createdAt": "2017-06-15T23:25:36Z",
    "diffHunk": "@@ -358,14 +358,26 @@ private[spark] class ApplicationMaster(\n       dummyRunner.launchContextDebugInfo()\n     }\n \n+    /**\n+     * (executorIdCounter, requestExecutors) should be the initial state\n+     * or the last state AM restart.\n+     *\n+     * @see SPARK-12864, SPARK-20079\n+     */\n+    val (executorIdCounter, requestExecutors) =\n+      driverRef.askSync[(Int, RequestExecutors)](GetAMInitialState)\n     allocator = client.register(driverUrl,\n       driverRef,\n       yarnConf,\n       _sparkConf,\n       uiAddress,\n       historyAddress,\n       securityMgr,\n-      localResources)\n+      localResources,\n+      executorIdCounter)\n+    if (requestExecutors.requestedTotal != allocator.getTargetNumExecutors) {\n+      amEndpoint.send(requestExecutors)",
    "line": 23
  }],
  "prId": 17882
}]