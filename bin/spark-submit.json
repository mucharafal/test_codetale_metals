[{
  "comments": [{
    "author": {
      "login": "srowen"
    },
    "body": "`SparkSubmitArguments` already ultimately handles this case, right? What does this fix?\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2014-12-29T09:16:16Z",
    "diffHunk": "@@ -42,7 +42,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+DEFAULT_PROPERTIES_FILE=\"$SPARK_CONF_DIR/spark-defaults.conf\""
  }, {
    "author": {
      "login": "WangTaoTheTonic"
    },
    "body": "Used for \n\n> if [[ \"$SPARK_SUBMIT_DEPLOY_MODE\" == \"client\" && -f \"$SPARK_SUBMIT_PROPERTIES_FILE\" ]]; then\n>   # Parse the properties file only if the special configs exist\n>   contains_special_configs=$(\n>     grep -e \"spark.driver.extra_|spark.driver.memory\" \"$SPARK_SUBMIT_PROPERTIES_FILE\" | \\\n>     grep -v \"^[[:space:]]_#\"\n>   )\n>   if [ -n \"$contains_special_configs\" ]; then\n>     export SPARK_SUBMIT_BOOTSTRAP_DRIVER=1\n>   fi\n> fi\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2014-12-29T09:36:03Z",
    "diffHunk": "@@ -42,7 +42,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+DEFAULT_PROPERTIES_FILE=\"$SPARK_CONF_DIR/spark-defaults.conf\""
  }],
  "prId": 3823
}, {
  "comments": [{
    "author": {
      "login": "srowen"
    },
    "body": "It's used here actually, but the purpose below seems to be detecting whether the user has set particular properties. Finding the default config doesn't matter here since it is a case where the user hasn't set these properties.\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2014-12-29T09:47:16Z",
    "diffHunk": "@@ -42,7 +42,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+DEFAULT_PROPERTIES_FILE=\"$SPARK_CONF_DIR/spark-defaults.conf\"\n+if [ ! -f \"DEFAULT_PROPERTIES_FILE\" ]; then\n+  DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+fi\n export SPARK_SUBMIT_DEPLOY_MODE=${SPARK_SUBMIT_DEPLOY_MODE:-\"client\"}\n export SPARK_SUBMIT_PROPERTIES_FILE=${SPARK_SUBMIT_PROPERTIES_FILE:-\"$DEFAULT_PROPERTIES_FILE\"}"
  }, {
    "author": {
      "login": "WangTaoTheTonic"
    },
    "body": "If user didn't pass `--properties-file` and define SPARK_CONF_DIR while not SPARK_HOME, then spark-submit will see if `spark.driver.extra*` in directory specified by `DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"`. Obviously it will make the wrong judgement when SPARK_CONF_DIR does not equal `$SPARK_HOME/conf`.\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2014-12-29T10:37:50Z",
    "diffHunk": "@@ -42,7 +42,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+DEFAULT_PROPERTIES_FILE=\"$SPARK_CONF_DIR/spark-defaults.conf\"\n+if [ ! -f \"DEFAULT_PROPERTIES_FILE\" ]; then\n+  DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+fi\n export SPARK_SUBMIT_DEPLOY_MODE=${SPARK_SUBMIT_DEPLOY_MODE:-\"client\"}\n export SPARK_SUBMIT_PROPERTIES_FILE=${SPARK_SUBMIT_PROPERTIES_FILE:-\"$DEFAULT_PROPERTIES_FILE\"}"
  }, {
    "author": {
      "login": "srowen"
    },
    "body": "OK I see the scenario now where this matters. So the default config for an installation might in fact set these special properties, which the script needs to handle before `SparkSubmit` starts. Maybe someone else can double-check, but that makes sense to me.\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2014-12-29T10:48:08Z",
    "diffHunk": "@@ -42,7 +42,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+DEFAULT_PROPERTIES_FILE=\"$SPARK_CONF_DIR/spark-defaults.conf\"\n+if [ ! -f \"DEFAULT_PROPERTIES_FILE\" ]; then\n+  DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+fi\n export SPARK_SUBMIT_DEPLOY_MODE=${SPARK_SUBMIT_DEPLOY_MODE:-\"client\"}\n export SPARK_SUBMIT_PROPERTIES_FILE=${SPARK_SUBMIT_PROPERTIES_FILE:-\"$DEFAULT_PROPERTIES_FILE\"}"
  }, {
    "author": {
      "login": "WangTaoTheTonic"
    },
    "body": "I mean there is a possibility that user don't use the conf sub-directory under default installation location but specified.\nFor instance, I touch a spark-defaults.conf under `/etc/my-spark/` and use it for submitting applications, so I set SPARK_CONF_DIR to `/etc/my-spark/` to make the properties file work.\nThe properties file under `$SPARK_HOME/conf` could be unused or used for submitting other applications.\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2014-12-29T10:58:45Z",
    "diffHunk": "@@ -42,7 +42,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+DEFAULT_PROPERTIES_FILE=\"$SPARK_CONF_DIR/spark-defaults.conf\"\n+if [ ! -f \"DEFAULT_PROPERTIES_FILE\" ]; then\n+  DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+fi\n export SPARK_SUBMIT_DEPLOY_MODE=${SPARK_SUBMIT_DEPLOY_MODE:-\"client\"}\n export SPARK_SUBMIT_PROPERTIES_FILE=${SPARK_SUBMIT_PROPERTIES_FILE:-\"$DEFAULT_PROPERTIES_FILE\"}"
  }],
  "prId": 3823
}, {
  "comments": [{
    "author": {
      "login": "OopsOutOfMemory"
    },
    "body": "I recommend to add `export` keyword to make the SPARK_CONF_DIR global :)\n\n```\n export SPARK_CONF_DIR=\"$SPARK_HOME/conf\"\n```\n\nJust like SPARK_HOME, it's a global variable.\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2014-12-30T02:51:33Z",
    "diffHunk": "@@ -42,7 +42,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+if [ ! -d \"$SPARK_CONF_DIR\" ]; then\n+  SPARK_CONF_DIR=\"$SPARK_HOME/conf\""
  }],
  "prId": 3823
}, {
  "comments": [{
    "author": {
      "login": "andrewor14"
    },
    "body": "actually, maybe this should be \"if not defined\" instead of \"if not exists\". Otherwise if the user sets `SPARK_CONF_DIR` to a directory that doesn't exist then this will silently use a different config.\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2015-01-09T17:43:59Z",
    "diffHunk": "@@ -44,7 +44,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+if [ ! -d \"$SPARK_CONF_DIR\" ]; then"
  }, {
    "author": {
      "login": "andrewor14"
    },
    "body": "i.e.\n\n```\nif [ -z \"$SPARK_CONF_DIR\" ]; then\n  export SPARK_CONF_DIR=\"$SPARK_HOME/conf\"\nfi\n```\n",
    "commit": "133c43e79482d2f88392dc287aa185564c2ed557",
    "createdAt": "2015-01-09T17:45:25Z",
    "diffHunk": "@@ -44,7 +44,10 @@ while (($#)); do\n   shift\n done\n \n-DEFAULT_PROPERTIES_FILE=\"$SPARK_HOME/conf/spark-defaults.conf\"\n+if [ ! -d \"$SPARK_CONF_DIR\" ]; then"
  }],
  "prId": 3823
}]