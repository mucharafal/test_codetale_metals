[{
  "comments": [{
    "author": {
      "login": "chenghao-intel"
    },
    "body": "I am wondering a better path would be `Utils.createTempDir(..)`, just in case we want to run the test suite simultaneously in the local machine as well.\n",
    "commit": "252fa0f70a93be81cf7b1151d720b5b7703cc011",
    "createdAt": "2015-02-25T04:56:21Z",
    "diffHunk": "@@ -315,7 +315,14 @@ abstract class HiveThriftServer2Test extends FunSuite with BeforeAndAfterAll wit\n \n     logInfo(s\"Trying to start HiveThriftServer2: port=$port, mode=$mode, attempt=$attempt\")\n \n-    logPath = Process(command, None, \"SPARK_TESTING\" -> \"0\").lines.collectFirst {\n+    val env = Seq(\n+      // Disables SPARK_TESTING to exclude log4j.properties in test directories.\n+      \"SPARK_TESTING\" -> \"0\",\n+      // Points SPARK_PID_DIR to SPARK_HOME, otherwise only 1 Thrift server instance can be started\n+      // at a time, which is not Jenkins friendly.\n+      \"SPARK_PID_DIR\" -> \"../../\")"
  }, {
    "author": {
      "login": "liancheng"
    },
    "body": "Good point.\n",
    "commit": "252fa0f70a93be81cf7b1151d720b5b7703cc011",
    "createdAt": "2015-02-26T09:38:59Z",
    "diffHunk": "@@ -315,7 +315,14 @@ abstract class HiveThriftServer2Test extends FunSuite with BeforeAndAfterAll wit\n \n     logInfo(s\"Trying to start HiveThriftServer2: port=$port, mode=$mode, attempt=$attempt\")\n \n-    logPath = Process(command, None, \"SPARK_TESTING\" -> \"0\").lines.collectFirst {\n+    val env = Seq(\n+      // Disables SPARK_TESTING to exclude log4j.properties in test directories.\n+      \"SPARK_TESTING\" -> \"0\",\n+      // Points SPARK_PID_DIR to SPARK_HOME, otherwise only 1 Thrift server instance can be started\n+      // at a time, which is not Jenkins friendly.\n+      \"SPARK_PID_DIR\" -> \"../../\")"
  }, {
    "author": {
      "login": "andrewor14"
    },
    "body": "actually, can we just use `sys.props(java.io.tmpdir)` instead of creating a new directory?\n",
    "commit": "252fa0f70a93be81cf7b1151d720b5b7703cc011",
    "createdAt": "2015-02-26T22:05:27Z",
    "diffHunk": "@@ -315,7 +315,14 @@ abstract class HiveThriftServer2Test extends FunSuite with BeforeAndAfterAll wit\n \n     logInfo(s\"Trying to start HiveThriftServer2: port=$port, mode=$mode, attempt=$attempt\")\n \n-    logPath = Process(command, None, \"SPARK_TESTING\" -> \"0\").lines.collectFirst {\n+    val env = Seq(\n+      // Disables SPARK_TESTING to exclude log4j.properties in test directories.\n+      \"SPARK_TESTING\" -> \"0\",\n+      // Points SPARK_PID_DIR to SPARK_HOME, otherwise only 1 Thrift server instance can be started\n+      // at a time, which is not Jenkins friendly.\n+      \"SPARK_PID_DIR\" -> \"../../\")"
  }, {
    "author": {
      "login": "chenghao-intel"
    },
    "body": "We need a different directory for each run, otherwise the PID file will be overwritten when multiple jenkins unit tests run parallel.\n",
    "commit": "252fa0f70a93be81cf7b1151d720b5b7703cc011",
    "createdAt": "2015-02-27T00:30:14Z",
    "diffHunk": "@@ -315,7 +315,14 @@ abstract class HiveThriftServer2Test extends FunSuite with BeforeAndAfterAll wit\n \n     logInfo(s\"Trying to start HiveThriftServer2: port=$port, mode=$mode, attempt=$attempt\")\n \n-    logPath = Process(command, None, \"SPARK_TESTING\" -> \"0\").lines.collectFirst {\n+    val env = Seq(\n+      // Disables SPARK_TESTING to exclude log4j.properties in test directories.\n+      \"SPARK_TESTING\" -> \"0\",\n+      // Points SPARK_PID_DIR to SPARK_HOME, otherwise only 1 Thrift server instance can be started\n+      // at a time, which is not Jenkins friendly.\n+      \"SPARK_PID_DIR\" -> \"../../\")"
  }, {
    "author": {
      "login": "andrewor14"
    },
    "body": "oh you're right. Looks like we currently set it to `/tmp` already, which is probably what `java.io.tmpdir` is anyway in most cases\n",
    "commit": "252fa0f70a93be81cf7b1151d720b5b7703cc011",
    "createdAt": "2015-02-27T02:54:42Z",
    "diffHunk": "@@ -315,7 +315,14 @@ abstract class HiveThriftServer2Test extends FunSuite with BeforeAndAfterAll wit\n \n     logInfo(s\"Trying to start HiveThriftServer2: port=$port, mode=$mode, attempt=$attempt\")\n \n-    logPath = Process(command, None, \"SPARK_TESTING\" -> \"0\").lines.collectFirst {\n+    val env = Seq(\n+      // Disables SPARK_TESTING to exclude log4j.properties in test directories.\n+      \"SPARK_TESTING\" -> \"0\",\n+      // Points SPARK_PID_DIR to SPARK_HOME, otherwise only 1 Thrift server instance can be started\n+      // at a time, which is not Jenkins friendly.\n+      \"SPARK_PID_DIR\" -> \"../../\")"
  }],
  "prId": 4758
}]