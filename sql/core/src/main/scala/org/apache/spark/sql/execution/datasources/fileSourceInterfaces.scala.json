[{
  "comments": [{
    "author": {
      "login": "liancheng"
    },
    "body": "Why `startsWith` instead of `==` here?\n",
    "commit": "705a76f84605f1d54e98caae7f81631bf80c8feb",
    "createdAt": "2016-05-20T20:09:01Z",
    "diffHunk": "@@ -341,11 +341,11 @@ private[sql] object HadoopFsRelation extends Logging {\n \n   /** Checks if we should filter out this path name. */\n   def shouldFilterOut(pathName: String): Boolean = {\n-    // TODO: We should try to filter out all files/dirs starting with \".\" or \"_\".\n-    // The only reason that we are not doing it now is that Parquet needs to find those\n-    // metadata files from leaf files returned by this methods. We should refactor\n-    // this logic to not mix metadata files with data files.\n-    pathName == \"_SUCCESS\" || pathName == \"_temporary\" || pathName.startsWith(\".\")\n+    // We filter everything that starts with _ and ., except _common_metadata and _metadata\n+    // because Parquet needs to find those metadata files from leaf files returned by this method.\n+    // We should refactor this logic to not mix metadata files with data files.\n+    (pathName.startsWith(\"_\") || pathName.startsWith(\".\")) &&\n+      !pathName.startsWith(\"_common_metadata\") && !pathName.startsWith(\"_metadata\")",
    "line": 13
  }, {
    "author": {
      "login": "rxin"
    },
    "body": "just in case we do other variants here ..\n",
    "commit": "705a76f84605f1d54e98caae7f81631bf80c8feb",
    "createdAt": "2016-05-20T20:21:23Z",
    "diffHunk": "@@ -341,11 +341,11 @@ private[sql] object HadoopFsRelation extends Logging {\n \n   /** Checks if we should filter out this path name. */\n   def shouldFilterOut(pathName: String): Boolean = {\n-    // TODO: We should try to filter out all files/dirs starting with \".\" or \"_\".\n-    // The only reason that we are not doing it now is that Parquet needs to find those\n-    // metadata files from leaf files returned by this methods. We should refactor\n-    // this logic to not mix metadata files with data files.\n-    pathName == \"_SUCCESS\" || pathName == \"_temporary\" || pathName.startsWith(\".\")\n+    // We filter everything that starts with _ and ., except _common_metadata and _metadata\n+    // because Parquet needs to find those metadata files from leaf files returned by this method.\n+    // We should refactor this logic to not mix metadata files with data files.\n+    (pathName.startsWith(\"_\") || pathName.startsWith(\".\")) &&\n+      !pathName.startsWith(\"_common_metadata\") && !pathName.startsWith(\"_metadata\")",
    "line": 13
  }],
  "prId": 13227
}]