[{
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "This test suite is only for positive cases, right? The above two test cases are negative cases. The negative cases can be added with the other negative cases. Right? We can put these two cases in the JIRA-18863.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T02:38:48Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);"
  }, {
    "author": {
      "login": "nsyca"
    },
    "body": "We will enable these two test cases once the problem is fixed. They remain here to demonstrate the test coverage of IN/NOT IN subquery. At this point, I have only done an initial investigation on SPARK-18863. Once the investigation is confirmed that these two cases have the same root cause as the one in 18863, they will be cross-referenced.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T13:41:44Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);"
  }, {
    "author": {
      "login": "gatorsmile"
    },
    "body": "These two test cases will not be part of this test suite, right? So far, no negative cases are added to this test suite.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T17:33:13Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);"
  }, {
    "author": {
      "login": "kevinyu98"
    },
    "body": "Sure, so we can add these test cases back when deliver the fixes as you mentioned below? I will put these test case into the JIRA-18863. Thanks.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-25T03:28:31Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);"
  }],
  "prId": 16337
}, {
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "Please add one more empty line here.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T02:47:01Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);\n+\n+-- GROUP BY in both\n+-- TC 01.14\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) group by t1a;\n+-- TC 01.15\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b in (select min(t3b) from t3\n+where t2a = t3a group by t3a) group by t2c) group by t1a, t1d;\n+-- TC 01.16\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) and\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.17\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.18\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a having t2a > t1a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d having t3d = t1d) group by t1a having min(t1b) is NOT NULL;\n+\n+-- Clean Up\n+DROP TABLE t1;\n+DROP TABLE t2;\n+DROP TABLE t3;\n+USE default;\n+DROP DATABASE indb;"
  }, {
    "author": {
      "login": "kevinyu98"
    },
    "body": "ok",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-25T03:29:17Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);\n+\n+-- GROUP BY in both\n+-- TC 01.14\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) group by t1a;\n+-- TC 01.15\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b in (select min(t3b) from t3\n+where t2a = t3a group by t3a) group by t2c) group by t1a, t1d;\n+-- TC 01.16\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) and\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.17\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.18\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a having t2a > t1a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d having t3d = t1d) group by t1a having min(t1b) is NOT NULL;\n+\n+-- Clean Up\n+DROP TABLE t1;\n+DROP TABLE t2;\n+DROP TABLE t3;\n+USE default;\n+DROP DATABASE indb;"
  }],
  "prId": 16337
}, {
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "Readability is not good for such complex queries. Could you re-format all the cases by using the tool like http://www.dpriver.com/pp/sqlformat.htm",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T02:52:02Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);\n+\n+-- GROUP BY in both\n+-- TC 01.14\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) group by t1a;\n+-- TC 01.15\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b in (select min(t3b) from t3\n+where t2a = t3a group by t3a) group by t2c) group by t1a, t1d;\n+-- TC 01.16\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) and\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.17\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.18\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a having t2a > t1a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d having t3d = t1d) group by t1a having min(t1b) is NOT NULL;"
  }, {
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "+1",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T20:02:13Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);\n+\n+-- GROUP BY in both\n+-- TC 01.14\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) group by t1a;\n+-- TC 01.15\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b in (select min(t3b) from t3\n+where t2a = t3a group by t3a) group by t2c) group by t1a, t1d;\n+-- TC 01.16\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) and\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.17\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.18\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a having t2a > t1a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d having t3d = t1d) group by t1a having min(t1b) is NOT NULL;"
  }, {
    "author": {
      "login": "kevinyu98"
    },
    "body": "sure.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-25T03:29:25Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;\n+CREATE TABLE t1(t1a String, t1b Short, t1c Int, t1d Long, t1e float, t1f double, t1g DECIMAL, t1h TIMESTAMP, t1i Date)\n+using parquet;\n+CREATE TABLE t2(t2a String, t2b Short, t2c Int, t2d Long, t2e float, t2f double, t2g DECIMAL, t2h TIMESTAMP, t2i Date)\n+using parquet;\n+CREATE TABLE t3(t3a String, t3b Short, t3c Int, t3d Long, t3e float, t3f double, t3g DECIMAL, t3h TIMESTAMP, t3i Date)\n+using parquet;\n+\n+-- insert to tables\n+INSERT INTO t1 VALUES\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1a', 16, 12, 21, 15, 20, 20.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1a', 16, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-05\")),\n+ ('t1d', null, 16, 22, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), null),\n+ ('t1d', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), null),\n+ ('t1e', 10, null, 25, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1d', 10, null, 12, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1a', 6, 8, 10, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1e', 10, null, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-0=4\"));\n+\n+INSERT INTO t2 VALUES\n+ ('t2a', 6, 12, 14, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 119, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\")),\n+ ('t1c', 12, 16, 219, 17, 25, 26.00, timestamp(date(\"2016-05-04\")), date(\"2016-05-04\")),\n+ ('t1b', null, 16, 319, 17, 25, 26.00, timestamp(date(\"2017-05-04\")), null),\n+ ('t2e', 8, null, 419, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1f', 19, null, 519, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t1c', 12, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-05\")),\n+ ('t1e', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-04\")),\n+ ('t1f', 19, null, 19, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), date(\"2014-10-04\")),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), null);\n+\n+INSERT INTO t3 VALUES\n+ ('t3a', 6, 12, 110, 15, 20, 20.00, timestamp(date(\"2014-04-04\")), date(\"2014-04-04\")),\n+ ('t3a', 6, 12, 10, 15, 20, 20.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 219, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 10, 12, 19, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t1b', 8, 16, 319, 17, 25, 26.00, timestamp(date(\"2014-06-04\")), date(\"2014-06-04\")),\n+ ('t1b', 8, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-07-04\")), date(\"2014-07-04\")),\n+ ('t3c', 17, 16, 519, 17, 25, 26.00, timestamp(date(\"2014-08-04\")), date(\"2014-08-04\")),\n+ ('t3c', 17, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-09-04\")), date(\"2014-09-05\")),\n+ ('t1b', null, 16, 419, 17, 25, 26.00, timestamp(date(\"2014-10-04\")), null),\n+ ('t1b', null, 16, 19, 17, 25, 26.00, timestamp(date(\"2014-11-04\")), null),\n+ ('t3b', 8, null, 719, 17, 25, 26.00, timestamp(date(\"2014-05-04\")), date(\"2014-05-04\")),\n+ ('t3b', 8, null, 19, 17, 25, 26.00, timestamp(date(\"2015-05-04\")), date(\"2015-05-04\"));\n+\n+-- correlated IN subquery\n+-- GROUP BY in parent side\n+-- TC 01.01\n+select t1a, avg(t1b) from t1 where t1a in (select t2a from t2) group by t1a;\n+-- TC 01.02\n+select t1a, max(t1b) from t1 where t1b in (select t2b from t2 where t1a = t2a) group by t1a, t1d;\n+-- TC 01.03\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t1a = t2a) group by t1a, t1b;\n+-- TC 01.04\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) or\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.05\n+select t1a, sum(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a) and\n+t1c in (select t3c from t3 where t1a = t3a) group by t1a, t1c;\n+-- TC 01.06\n+select t1a, count(distinct(t1b)) from t1 where t1c in (select t2c from t2 where t1a = t2a)\n+group by t1a, t1c having t1a = \"t1b\";\n+\n+-- GROUP BY in subquery\n+-- TC 01.07\n+select * from t1 where t1b in (select max(t2b) from t2 group by t2a);\n+-- TC 01.08\n+select * from (select t2a, t2b from t2 where t2a in (select t1a from t1 where t1b = t2b) group by t2a, t2b) t2;\n+-- TC 01.09\n+select count(distinct(*)) from t1 where t1b in (select min(t2b) from t2 where t1a = t2a and t1c = t2c group by t2a);\n+-- TC 01.10\n+select t1a, t1b from t1 where t1c in (select max(t2c) from t2 where t1a = t2a group by t2a, t2c having t2c > 8);\n+-- TC 01.11\n+select t1a, t1b from t1 where t1c in (select t2c from t2 where t2a in\n+(select min(t3a) from t3 where t3a = t2a group by t3b) group by t2c);\n+-- TC 01.12, comment out pending SPARK-18863\n+--select * from t1 where t1a in\n+--(select min(t2a) from t2 where t2a = t2a and t2c >= 1 group by t2c having t2c in\n+--(select t3c from t3 group by t3c, t3b having t2b > 6 and t3b > t2b ));\n+-- TC 01.13, comment out pending SPARK-18863\n+--select * from (select * from t2 where t2a in (select t1a from t1 where t1b = t2b)) t2 where t2a in\n+--(select t2a from t2 where t2a = t2a and t2c > 1 group by t2a having t2c > 8);\n+\n+-- GROUP BY in both\n+-- TC 01.14\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) group by t1a;\n+-- TC 01.15\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b in (select min(t3b) from t3\n+where t2a = t3a group by t3a) group by t2c) group by t1a, t1d;\n+-- TC 01.16\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) and\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.17\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d) group by t1a;\n+-- TC 01.18\n+select t1a, min(t1b) from t1 where t1c in (select min(t2c) from t2 where t2b = t1b group by t2a having t2a > t1a) or\n+t1d in (select t3d from t3 where t1c = t3c group by t3d having t3d = t1d) group by t1a having min(t1b) is NOT NULL;"
  }],
  "prId": 16337
}, {
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "You created a database, but you did not use it. \r\n\r\nMaybe you do not need it.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T03:00:19Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;"
  }, {
    "author": {
      "login": "nsyca"
    },
    "body": "The statement CREATE DATABASE/DROP DATABASE is used to isolate all the objects created in this test file to its own database/schema. The purpose is to protect any name collision from other test files leaving objects of the same names without properly dropping them. The use of different database/schema mitigates this problem as the chance of having the same database/schema name in two different test files is low.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T13:29:26Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;"
  }, {
    "author": {
      "login": "nsyca"
    },
    "body": "I guess what's missing here is the `USE indb` after the `CREATE DATABASE` to direct all the objects created after this statement to have a different database/schema. My bad. I thought `CREATE DATABASE` implicitly switch to a new database/schema.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T13:49:09Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;"
  }, {
    "author": {
      "login": "gatorsmile"
    },
    "body": "For each test suite, (e.g., in-group-by.sql), we create a dedicated sesssion. See [the code](https://github.com/apache/spark/blob/master/sql/core/src/test/scala/org/apache/spark/sql/SQLQueryTestSuite.scala#L144-L147). \r\n\r\nWhy not creating temporary views? These views will be automatically removed after the session ends. ",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T17:40:48Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;"
  }, {
    "author": {
      "login": "nsyca"
    },
    "body": "If there is no explicit restriction, I would like to keep the create database/use database so that the test file is self-contained and can be run in different environments with minimal side effect.\r\n\r\nI don't have any preference between real tables or temporary views but variations are good to exercise different code paths. If all the test cases are written homogeneously to certain patterns, it limits the coverage. Again, if there is no explicit rules or guidelines on which particular ways to write test cases, I would like to request to have it kept at this format.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-24T20:15:51Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;"
  }, {
    "author": {
      "login": "kevinyu98"
    },
    "body": "ok, I will remove it.",
    "commit": "895bb35cf951e68936d26e81490a89e56a08d834",
    "createdAt": "2016-12-25T03:29:33Z",
    "diffHunk": "@@ -0,0 +1,117 @@\n+-- A test suite for GROUP BY in parent side, subquery, and both predicate subquery\n+-- It includes correlated cases.\n+\n+-- tables and data types\n+\n+CREATE DATABASE indb;"
  }],
  "prId": 16337
}]