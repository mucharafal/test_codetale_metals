[{
  "comments": [{
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "Hi, @dilipbiswal .\r\nCan we have another test case, `TC.02.05`, here for `UNION` instead of `UNION ALL`?",
    "commit": "3ebd654bca1cad01fa96b924ececd12fd33ef516",
    "createdAt": "2017-02-05T02:22:25Z",
    "diffHunk": "@@ -0,0 +1,206 @@\n+-- Tests EXISTS subquery support. Tests Exists subquery\n+-- used in Joins (Both when joins occurs in outer and suquery blocks)\n+\n+CREATE TEMPORARY VIEW EMP AS SELECT * FROM VALUES\n+  (100, \"emp 1\", date \"2005-01-01\", 100.00D, 10),\n+  (100, \"emp 1\", date \"2005-01-01\", 100.00D, 10),\n+  (200, \"emp 2\", date \"2003-01-01\", 200.00D, 10),\n+  (300, \"emp 3\", date \"2002-01-01\", 300.00D, 20),\n+  (400, \"emp 4\", date \"2005-01-01\", 400.00D, 30),\n+  (500, \"emp 5\", date \"2001-01-01\", 400.00D, NULL),\n+  (600, \"emp 6 - no dept\", date \"2001-01-01\", 400.00D, 100),\n+  (700, \"emp 7\", date \"2010-01-01\", 400.00D, 100),\n+  (800, \"emp 8\", date \"2016-01-01\", 150.00D, 70)\n+AS EMP(id, emp_name, hiredate, salary, dept_id);\n+\n+CREATE TEMPORARY VIEW DEPT AS SELECT * FROM VALUES\n+  (10, \"dept 1\", \"CA\"),\n+  (20, \"dept 2\", \"NY\"),\n+  (30, \"dept 3\", \"TX\"),\n+  (40, \"dept 4 - unassigned\", \"OR\"),\n+  (50, \"dept 5 - unassigned\", \"NJ\"),\n+  (70, \"dept 7\", \"FL\")\n+AS DEPT(dept_id, dept_name, state);\n+\n+CREATE TEMPORARY VIEW BONUS AS SELECT * FROM VALUES\n+  (\"emp 1\", 10.00D),\n+  (\"emp 1\", 20.00D),\n+  (\"emp 2\", 300.00D),\n+  (\"emp 2\", 100.00D),\n+  (\"emp 3\", 300.00D),\n+  (\"emp 4\", 100.00D),\n+  (\"emp 5\", 1000.00D),\n+  (\"emp 6 - no dept\", 500.00D)\n+AS BONUS(emp_name, bonus_amt);\n+\n+-- Join in outer query block\n+-- TC.01.01\n+SELECT * \n+FROM   emp, \n+       dept \n+WHERE  emp.dept_id = dept.dept_id \n+       AND EXISTS (SELECT * \n+                   FROM   bonus \n+                   WHERE  bonus.emp_name = emp.emp_name); \n+\n+-- Join in outer query block with ON condition \n+-- TC.01.02\n+SELECT * \n+FROM   emp \n+       JOIN dept \n+         ON emp.dept_id = dept.dept_id \n+WHERE  EXISTS (SELECT * \n+               FROM   bonus \n+               WHERE  bonus.emp_name = emp.emp_name);\n+\n+-- Left join in outer query block with ON condition \n+-- TC.01.03\n+SELECT * \n+FROM   emp \n+       LEFT JOIN dept \n+              ON emp.dept_id = dept.dept_id \n+WHERE  EXISTS (SELECT * \n+               FROM   bonus \n+               WHERE  bonus.emp_name = emp.emp_name); \n+\n+-- Join in outer query block + NOT EXISTS\n+-- TC.01.04\n+SELECT * \n+FROM   emp, \n+       dept \n+WHERE  emp.dept_id = dept.dept_id \n+       AND NOT EXISTS (SELECT * \n+                       FROM   bonus \n+                       WHERE  bonus.emp_name = emp.emp_name); \n+\n+\n+-- inner join in subquery.\n+-- TC.01.05\n+SELECT * \n+FROM   bonus \n+WHERE  EXISTS (SELECT * \n+                 FROM   emp \n+                        JOIN dept \n+                          ON dept.dept_id = emp.dept_id \n+                 WHERE  bonus.emp_name = emp.emp_name); \n+\n+-- right join in subquery\n+-- TC.01.06\n+SELECT * \n+FROM   bonus \n+WHERE  EXISTS (SELECT * \n+                 FROM   emp \n+                        RIGHT JOIN dept \n+                                ON dept.dept_id = emp.dept_id \n+                 WHERE  bonus.emp_name = emp.emp_name); \n+\n+\n+-- Aggregation and join in subquery\n+-- TC.01.07\n+SELECT * \n+FROM   bonus \n+WHERE  EXISTS (SELECT dept.dept_id, \n+                        emp.emp_name, \n+                        Max(salary), \n+                        Count(*) \n+                 FROM   emp \n+                        JOIN dept \n+                          ON dept.dept_id = emp.dept_id \n+                 WHERE  bonus.emp_name = emp.emp_name \n+                 GROUP  BY dept.dept_id, \n+                           emp.emp_name \n+                 ORDER  BY emp.emp_name);\n+\n+-- Aggregations in outer and subquery + join in subquery\n+-- TC.01.08\n+SELECT emp_name, \n+       Sum(bonus_amt) \n+FROM   bonus \n+WHERE  EXISTS (SELECT emp_name, \n+                        Max(salary) \n+                 FROM   emp \n+                        JOIN dept \n+                          ON dept.dept_id = emp.dept_id \n+                 WHERE  bonus.emp_name = emp.emp_name \n+                 GROUP  BY emp_name \n+                 HAVING Count(*) > 1 \n+                 ORDER  BY emp_name)\n+GROUP  BY emp_name; \n+\n+-- TC.01.09\n+SELECT emp_name, \n+       Sum(bonus_amt) \n+FROM   bonus \n+WHERE  NOT EXISTS (SELECT emp_name, \n+                          Max(salary) \n+                   FROM   emp \n+                          JOIN dept \n+                            ON dept.dept_id = emp.dept_id \n+                   WHERE  bonus.emp_name = emp.emp_name \n+                   GROUP  BY emp_name \n+                   HAVING Count(*) > 1 \n+                   ORDER  BY emp_name) \n+GROUP  BY emp_name;\n+\n+-- Set operations along with EXISTS subquery\n+-- union\n+-- TC.02.01 \n+SELECT * \n+FROM   emp \n+WHERE  EXISTS (SELECT * \n+               FROM   dept \n+               WHERE  dept_id < 30 \n+               UNION \n+               SELECT * \n+               FROM   dept \n+               WHERE  dept_id >= 30 \n+                      AND dept_id <= 50); \n+\n+-- intersect \n+-- TC.02.02 \n+SELECT * \n+FROM   emp \n+WHERE  EXISTS (SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id < 30 \n+                 INTERSECT \n+                 SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id >= 30 \n+                        AND dept_id <= 50);\n+\n+-- intersect + not exists \n+-- TC.02.03                \n+SELECT * \n+FROM   emp \n+WHERE  NOT EXISTS (SELECT * \n+                     FROM   dept \n+                     WHERE  dept_id < 30 \n+                     INTERSECT \n+                     SELECT * \n+                     FROM   dept \n+                     WHERE  dept_id >= 30 \n+                            AND dept_id <= 50); \n+\n+-- Union in outer query and except,intersect in subqueries. \n+-- TC.02.04       \n+SELECT * \n+FROM   emp \n+WHERE  EXISTS (SELECT * \n+                 FROM   dept \n+                 EXCEPT \n+                 SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id > 50)\n+UNION ALL \n+SELECT * \n+FROM   emp \n+WHERE  EXISTS (SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id < 30 \n+                 INTERSECT \n+                 SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id >= 30 \n+                        AND dept_id <= 50);\n+",
    "line": 171
  }, {
    "author": {
      "login": "dilipbiswal"
    },
    "body": "@dongjoon-hyun Thanks !! I have added the UNION test case. I have also uploaded the updated db2 result file.",
    "commit": "3ebd654bca1cad01fa96b924ececd12fd33ef516",
    "createdAt": "2017-02-05T20:38:18Z",
    "diffHunk": "@@ -0,0 +1,206 @@\n+-- Tests EXISTS subquery support. Tests Exists subquery\n+-- used in Joins (Both when joins occurs in outer and suquery blocks)\n+\n+CREATE TEMPORARY VIEW EMP AS SELECT * FROM VALUES\n+  (100, \"emp 1\", date \"2005-01-01\", 100.00D, 10),\n+  (100, \"emp 1\", date \"2005-01-01\", 100.00D, 10),\n+  (200, \"emp 2\", date \"2003-01-01\", 200.00D, 10),\n+  (300, \"emp 3\", date \"2002-01-01\", 300.00D, 20),\n+  (400, \"emp 4\", date \"2005-01-01\", 400.00D, 30),\n+  (500, \"emp 5\", date \"2001-01-01\", 400.00D, NULL),\n+  (600, \"emp 6 - no dept\", date \"2001-01-01\", 400.00D, 100),\n+  (700, \"emp 7\", date \"2010-01-01\", 400.00D, 100),\n+  (800, \"emp 8\", date \"2016-01-01\", 150.00D, 70)\n+AS EMP(id, emp_name, hiredate, salary, dept_id);\n+\n+CREATE TEMPORARY VIEW DEPT AS SELECT * FROM VALUES\n+  (10, \"dept 1\", \"CA\"),\n+  (20, \"dept 2\", \"NY\"),\n+  (30, \"dept 3\", \"TX\"),\n+  (40, \"dept 4 - unassigned\", \"OR\"),\n+  (50, \"dept 5 - unassigned\", \"NJ\"),\n+  (70, \"dept 7\", \"FL\")\n+AS DEPT(dept_id, dept_name, state);\n+\n+CREATE TEMPORARY VIEW BONUS AS SELECT * FROM VALUES\n+  (\"emp 1\", 10.00D),\n+  (\"emp 1\", 20.00D),\n+  (\"emp 2\", 300.00D),\n+  (\"emp 2\", 100.00D),\n+  (\"emp 3\", 300.00D),\n+  (\"emp 4\", 100.00D),\n+  (\"emp 5\", 1000.00D),\n+  (\"emp 6 - no dept\", 500.00D)\n+AS BONUS(emp_name, bonus_amt);\n+\n+-- Join in outer query block\n+-- TC.01.01\n+SELECT * \n+FROM   emp, \n+       dept \n+WHERE  emp.dept_id = dept.dept_id \n+       AND EXISTS (SELECT * \n+                   FROM   bonus \n+                   WHERE  bonus.emp_name = emp.emp_name); \n+\n+-- Join in outer query block with ON condition \n+-- TC.01.02\n+SELECT * \n+FROM   emp \n+       JOIN dept \n+         ON emp.dept_id = dept.dept_id \n+WHERE  EXISTS (SELECT * \n+               FROM   bonus \n+               WHERE  bonus.emp_name = emp.emp_name);\n+\n+-- Left join in outer query block with ON condition \n+-- TC.01.03\n+SELECT * \n+FROM   emp \n+       LEFT JOIN dept \n+              ON emp.dept_id = dept.dept_id \n+WHERE  EXISTS (SELECT * \n+               FROM   bonus \n+               WHERE  bonus.emp_name = emp.emp_name); \n+\n+-- Join in outer query block + NOT EXISTS\n+-- TC.01.04\n+SELECT * \n+FROM   emp, \n+       dept \n+WHERE  emp.dept_id = dept.dept_id \n+       AND NOT EXISTS (SELECT * \n+                       FROM   bonus \n+                       WHERE  bonus.emp_name = emp.emp_name); \n+\n+\n+-- inner join in subquery.\n+-- TC.01.05\n+SELECT * \n+FROM   bonus \n+WHERE  EXISTS (SELECT * \n+                 FROM   emp \n+                        JOIN dept \n+                          ON dept.dept_id = emp.dept_id \n+                 WHERE  bonus.emp_name = emp.emp_name); \n+\n+-- right join in subquery\n+-- TC.01.06\n+SELECT * \n+FROM   bonus \n+WHERE  EXISTS (SELECT * \n+                 FROM   emp \n+                        RIGHT JOIN dept \n+                                ON dept.dept_id = emp.dept_id \n+                 WHERE  bonus.emp_name = emp.emp_name); \n+\n+\n+-- Aggregation and join in subquery\n+-- TC.01.07\n+SELECT * \n+FROM   bonus \n+WHERE  EXISTS (SELECT dept.dept_id, \n+                        emp.emp_name, \n+                        Max(salary), \n+                        Count(*) \n+                 FROM   emp \n+                        JOIN dept \n+                          ON dept.dept_id = emp.dept_id \n+                 WHERE  bonus.emp_name = emp.emp_name \n+                 GROUP  BY dept.dept_id, \n+                           emp.emp_name \n+                 ORDER  BY emp.emp_name);\n+\n+-- Aggregations in outer and subquery + join in subquery\n+-- TC.01.08\n+SELECT emp_name, \n+       Sum(bonus_amt) \n+FROM   bonus \n+WHERE  EXISTS (SELECT emp_name, \n+                        Max(salary) \n+                 FROM   emp \n+                        JOIN dept \n+                          ON dept.dept_id = emp.dept_id \n+                 WHERE  bonus.emp_name = emp.emp_name \n+                 GROUP  BY emp_name \n+                 HAVING Count(*) > 1 \n+                 ORDER  BY emp_name)\n+GROUP  BY emp_name; \n+\n+-- TC.01.09\n+SELECT emp_name, \n+       Sum(bonus_amt) \n+FROM   bonus \n+WHERE  NOT EXISTS (SELECT emp_name, \n+                          Max(salary) \n+                   FROM   emp \n+                          JOIN dept \n+                            ON dept.dept_id = emp.dept_id \n+                   WHERE  bonus.emp_name = emp.emp_name \n+                   GROUP  BY emp_name \n+                   HAVING Count(*) > 1 \n+                   ORDER  BY emp_name) \n+GROUP  BY emp_name;\n+\n+-- Set operations along with EXISTS subquery\n+-- union\n+-- TC.02.01 \n+SELECT * \n+FROM   emp \n+WHERE  EXISTS (SELECT * \n+               FROM   dept \n+               WHERE  dept_id < 30 \n+               UNION \n+               SELECT * \n+               FROM   dept \n+               WHERE  dept_id >= 30 \n+                      AND dept_id <= 50); \n+\n+-- intersect \n+-- TC.02.02 \n+SELECT * \n+FROM   emp \n+WHERE  EXISTS (SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id < 30 \n+                 INTERSECT \n+                 SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id >= 30 \n+                        AND dept_id <= 50);\n+\n+-- intersect + not exists \n+-- TC.02.03                \n+SELECT * \n+FROM   emp \n+WHERE  NOT EXISTS (SELECT * \n+                     FROM   dept \n+                     WHERE  dept_id < 30 \n+                     INTERSECT \n+                     SELECT * \n+                     FROM   dept \n+                     WHERE  dept_id >= 30 \n+                            AND dept_id <= 50); \n+\n+-- Union in outer query and except,intersect in subqueries. \n+-- TC.02.04       \n+SELECT * \n+FROM   emp \n+WHERE  EXISTS (SELECT * \n+                 FROM   dept \n+                 EXCEPT \n+                 SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id > 50)\n+UNION ALL \n+SELECT * \n+FROM   emp \n+WHERE  EXISTS (SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id < 30 \n+                 INTERSECT \n+                 SELECT * \n+                 FROM   dept \n+                 WHERE  dept_id >= 30 \n+                        AND dept_id <= 50);\n+",
    "line": 171
  }],
  "prId": 16802
}]