[{
  "comments": [{
    "author": {
      "login": "viirya"
    },
    "body": "Doesn't this have explicit group by?",
    "commit": "2ecf3e183e51f13ec9c92692d29854f01eb327c5",
    "createdAt": "2018-07-20T00:57:14Z",
    "diffHunk": "@@ -13,5 +13,39 @@ SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((a));\n -- SPARK-17849: grouping set throws NPE #3\n SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((c));\n \n+-- Group sets without explicit group by\n+SELECT c1, sum(c2) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n \n+-- Group sets without group by and with grouping\n+SELECT c1, sum(c2), grouping(c1) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n+\n+-- Mutiple grouping within a grouping set\n+SELECT c1, c2, Sum(c3), grouping__id\n+FROM   (VALUES ('x', 'a', 10), ('y', 'b', 20) ) AS t (c1, c2, c3)\n+GROUP  BY GROUPING SETS ( ( c1 ), ( c2 ) )\n+HAVING GROUPING__ID > 1;\n+\n+-- Group sets without explicit group by\n+SELECT grouping(c1) FROM (VALUES ('x', 'a', 10), ('y', 'b', 20)) AS t (c1, c2, c3) GROUP BY c1,c2 GROUPING SETS (c1,c2);"
  }, {
    "author": {
      "login": "dilipbiswal"
    },
    "body": "@viirya sorry.. yeah.. i will remove the explicit group by cols.. I had it for testing but forgot to take them out.",
    "commit": "2ecf3e183e51f13ec9c92692d29854f01eb327c5",
    "createdAt": "2018-07-20T01:24:46Z",
    "diffHunk": "@@ -13,5 +13,39 @@ SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((a));\n -- SPARK-17849: grouping set throws NPE #3\n SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((c));\n \n+-- Group sets without explicit group by\n+SELECT c1, sum(c2) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n \n+-- Group sets without group by and with grouping\n+SELECT c1, sum(c2), grouping(c1) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n+\n+-- Mutiple grouping within a grouping set\n+SELECT c1, c2, Sum(c3), grouping__id\n+FROM   (VALUES ('x', 'a', 10), ('y', 'b', 20) ) AS t (c1, c2, c3)\n+GROUP  BY GROUPING SETS ( ( c1 ), ( c2 ) )\n+HAVING GROUPING__ID > 1;\n+\n+-- Group sets without explicit group by\n+SELECT grouping(c1) FROM (VALUES ('x', 'a', 10), ('y', 'b', 20)) AS t (c1, c2, c3) GROUP BY c1,c2 GROUPING SETS (c1,c2);"
  }],
  "prId": 21813
}, {
  "comments": [{
    "author": {
      "login": "viirya"
    },
    "body": "I've manually verified the results should be correct.",
    "commit": "2ecf3e183e51f13ec9c92692d29854f01eb327c5",
    "createdAt": "2018-07-20T01:00:53Z",
    "diffHunk": "@@ -13,5 +13,39 @@ SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((a));\n -- SPARK-17849: grouping set throws NPE #3\n SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((c));\n \n+-- Group sets without explicit group by\n+SELECT c1, sum(c2) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n \n+-- Group sets without group by and with grouping\n+SELECT c1, sum(c2), grouping(c1) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n+\n+-- Mutiple grouping within a grouping set\n+SELECT c1, c2, Sum(c3), grouping__id\n+FROM   (VALUES ('x', 'a', 10), ('y', 'b', 20) ) AS t (c1, c2, c3)\n+GROUP  BY GROUPING SETS ( ( c1 ), ( c2 ) )\n+HAVING GROUPING__ID > 1;\n+\n+-- Group sets without explicit group by\n+SELECT grouping(c1) FROM (VALUES ('x', 'a', 10), ('y', 'b', 20)) AS t (c1, c2, c3) GROUP BY c1,c2 GROUPING SETS (c1,c2);\n+\n+-- Mutiple grouping within a grouping set\n+SELECT -c1 AS c1 FROM (values (1,2), (3,2)) t(c1, c2) GROUP BY GROUPING SETS ((c1), (c1, c2));\n+\n+-- complex expression in grouping sets\n+SELECT a + b, b, sum(c) FROM (VALUES (1,1,1),(2,2,2)) AS t(a,b,c) GROUP BY GROUPING SETS ( (a + b), (b));\n+\n+-- complex expression in grouping sets\n+SELECT a + b, b, sum(c) FROM (VALUES (1,1,1),(2,2,2)) AS t(a,b,c) GROUP BY GROUPING SETS ( (a + b), (b + a), (b));\n+\n+-- more query constructs with grouping sets\n+SELECT c1 AS col1, c2 AS col2\n+FROM   (VALUES (1, 2), (3, 2)) t(c1, c2)\n+GROUP  BY GROUPING SETS ( ( c1 ), ( c1, c2 ) )\n+HAVING col2 IS NOT NULL\n+ORDER  BY -col1;",
    "line": 33
  }, {
    "author": {
      "login": "dilipbiswal"
    },
    "body": "@viirya Sorry Simon.. do i have to do something for this comment ?",
    "commit": "2ecf3e183e51f13ec9c92692d29854f01eb327c5",
    "createdAt": "2018-07-20T01:20:29Z",
    "diffHunk": "@@ -13,5 +13,39 @@ SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((a));\n -- SPARK-17849: grouping set throws NPE #3\n SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((c));\n \n+-- Group sets without explicit group by\n+SELECT c1, sum(c2) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n \n+-- Group sets without group by and with grouping\n+SELECT c1, sum(c2), grouping(c1) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n+\n+-- Mutiple grouping within a grouping set\n+SELECT c1, c2, Sum(c3), grouping__id\n+FROM   (VALUES ('x', 'a', 10), ('y', 'b', 20) ) AS t (c1, c2, c3)\n+GROUP  BY GROUPING SETS ( ( c1 ), ( c2 ) )\n+HAVING GROUPING__ID > 1;\n+\n+-- Group sets without explicit group by\n+SELECT grouping(c1) FROM (VALUES ('x', 'a', 10), ('y', 'b', 20)) AS t (c1, c2, c3) GROUP BY c1,c2 GROUPING SETS (c1,c2);\n+\n+-- Mutiple grouping within a grouping set\n+SELECT -c1 AS c1 FROM (values (1,2), (3,2)) t(c1, c2) GROUP BY GROUPING SETS ((c1), (c1, c2));\n+\n+-- complex expression in grouping sets\n+SELECT a + b, b, sum(c) FROM (VALUES (1,1,1),(2,2,2)) AS t(a,b,c) GROUP BY GROUPING SETS ( (a + b), (b));\n+\n+-- complex expression in grouping sets\n+SELECT a + b, b, sum(c) FROM (VALUES (1,1,1),(2,2,2)) AS t(a,b,c) GROUP BY GROUPING SETS ( (a + b), (b + a), (b));\n+\n+-- more query constructs with grouping sets\n+SELECT c1 AS col1, c2 AS col2\n+FROM   (VALUES (1, 2), (3, 2)) t(c1, c2)\n+GROUP  BY GROUPING SETS ( ( c1 ), ( c1, c2 ) )\n+HAVING col2 IS NOT NULL\n+ORDER  BY -col1;",
    "line": 33
  }, {
    "author": {
      "login": "viirya"
    },
    "body": "Not at all. @dilipbiswal :-)",
    "commit": "2ecf3e183e51f13ec9c92692d29854f01eb327c5",
    "createdAt": "2018-07-20T01:31:53Z",
    "diffHunk": "@@ -13,5 +13,39 @@ SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((a));\n -- SPARK-17849: grouping set throws NPE #3\n SELECT a, b, c, count(d) FROM grouping GROUP BY a, b, c GROUPING SETS ((c));\n \n+-- Group sets without explicit group by\n+SELECT c1, sum(c2) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n \n+-- Group sets without group by and with grouping\n+SELECT c1, sum(c2), grouping(c1) FROM (VALUES ('x', 10, 0), ('y', 20, 0)) AS t (c1, c2, c3) GROUP BY GROUPING SETS (c1);\n+\n+-- Mutiple grouping within a grouping set\n+SELECT c1, c2, Sum(c3), grouping__id\n+FROM   (VALUES ('x', 'a', 10), ('y', 'b', 20) ) AS t (c1, c2, c3)\n+GROUP  BY GROUPING SETS ( ( c1 ), ( c2 ) )\n+HAVING GROUPING__ID > 1;\n+\n+-- Group sets without explicit group by\n+SELECT grouping(c1) FROM (VALUES ('x', 'a', 10), ('y', 'b', 20)) AS t (c1, c2, c3) GROUP BY c1,c2 GROUPING SETS (c1,c2);\n+\n+-- Mutiple grouping within a grouping set\n+SELECT -c1 AS c1 FROM (values (1,2), (3,2)) t(c1, c2) GROUP BY GROUPING SETS ((c1), (c1, c2));\n+\n+-- complex expression in grouping sets\n+SELECT a + b, b, sum(c) FROM (VALUES (1,1,1),(2,2,2)) AS t(a,b,c) GROUP BY GROUPING SETS ( (a + b), (b));\n+\n+-- complex expression in grouping sets\n+SELECT a + b, b, sum(c) FROM (VALUES (1,1,1),(2,2,2)) AS t(a,b,c) GROUP BY GROUPING SETS ( (a + b), (b + a), (b));\n+\n+-- more query constructs with grouping sets\n+SELECT c1 AS col1, c2 AS col2\n+FROM   (VALUES (1, 2), (3, 2)) t(c1, c2)\n+GROUP  BY GROUPING SETS ( ( c1 ), ( c1, c2 ) )\n+HAVING col2 IS NOT NULL\n+ORDER  BY -col1;",
    "line": 33
  }],
  "prId": 21813
}]