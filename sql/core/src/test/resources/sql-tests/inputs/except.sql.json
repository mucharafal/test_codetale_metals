[{
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "Line 14 to 28 are not needed. You can embed the temp view into the line 31 -43 queries.",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-14T06:13:43Z",
    "diffHunk": "@@ -0,0 +1,43 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5)\n+  as t2(k, v);\n+\n+create temporary view t3 as select * from t1 where v <> 1 and v <> 2;\n+\n+create temporary view t4 as select * from t1 where v <> 2 and v >= 3;\n+\n+create temporary view t5 as select * from t2 where v >= 1 and v <> 22;\n+\n+SELECT * FROM t1;\n+\n+SELECT * FROM t2;\n+\n+SELECT * FROM t3;\n+\n+SELECT * FROM t4;\n+\n+SELECT * FROM t5;"
  }],
  "prId": 19451
}, {
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "Add an empty line. ",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-14T06:13:51Z",
    "diffHunk": "@@ -0,0 +1,43 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5)\n+  as t2(k, v);\n+\n+create temporary view t3 as select * from t1 where v <> 1 and v <> 2;\n+\n+create temporary view t4 as select * from t1 where v <> 2 and v >= 3;\n+\n+create temporary view t5 as select * from t2 where v >= 1 and v <> 22;\n+\n+SELECT * FROM t1;\n+\n+SELECT * FROM t2;\n+\n+SELECT * FROM t3;\n+\n+SELECT * FROM t4;\n+\n+SELECT * FROM t5;\n+\n+-- Except operation that will be replaced by left anti join\n+SELECT * FROM t1 EXCEPT SELECT * FROM t2;\n+\n+\n+-- Except operation that will be replaced by Filter: SPARK-22181 - case 1\n+SELECT * FROM t1 EXCEPT SELECT * FROM t3;\n+\n+\n+-- Except operation that will be replaced by Filter: SPARK-22181 - case 2\n+SELECT * FROM t3 EXCEPT SELECT * FROM t4;\n+\n+\n+-- Except operation that will be replace by left anti join\n+SELECT * FROM t5 EXCEPT SELECT * FROM t1;"
  }],
  "prId": 19451
}, {
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "Also add a case for `NULL`.  Thanks!",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-14T06:14:19Z",
    "diffHunk": "@@ -0,0 +1,43 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5)"
  }],
  "prId": 19451
}, {
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "To see whether these SQL use the rule you added, you can add `EXPLAIN EXTENDED` before the actual query `SELECT * FROM t1 EXCEPT SELECT * FROM t2`\r\n\r\nYou will see the optimized plan and check whether the rule is applicable. \r\n\r\n",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-27T16:30:22Z",
    "diffHunk": "@@ -0,0 +1,57 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3),\n+  (\"one\", NULL)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5),\n+  (\"one\", NULL),\n+  (NULL, 5)\n+  as t2(k, v);\n+\n+\n+-- Except operation that will be replaced by left anti join\n+SELECT * FROM t1 EXCEPT SELECT * FROM t2;",
    "line": 19
  }, {
    "author": {
      "login": "gatorsmile"
    },
    "body": "BTW, because our plan is not stable, I am not asking you for outputting the plan in the test cases. This is just to help you debug the codes. Thanks!",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-27T16:32:44Z",
    "diffHunk": "@@ -0,0 +1,57 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3),\n+  (\"one\", NULL)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5),\n+  (\"one\", NULL),\n+  (NULL, 5)\n+  as t2(k, v);\n+\n+\n+-- Except operation that will be replaced by left anti join\n+SELECT * FROM t1 EXCEPT SELECT * FROM t2;",
    "line": 19
  }, {
    "author": {
      "login": "sathiyapk"
    },
    "body": "Thanks, good to know. I have been manually testing it via spark shell.",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-27T17:42:42Z",
    "diffHunk": "@@ -0,0 +1,57 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3),\n+  (\"one\", NULL)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5),\n+  (\"one\", NULL),\n+  (NULL, 5)\n+  as t2(k, v);\n+\n+\n+-- Except operation that will be replaced by left anti join\n+SELECT * FROM t1 EXCEPT SELECT * FROM t2;",
    "line": 19
  }, {
    "author": {
      "login": "gatorsmile"
    },
    "body": "How about the result?",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-27T17:59:04Z",
    "diffHunk": "@@ -0,0 +1,57 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3),\n+  (\"one\", NULL)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5),\n+  (\"one\", NULL),\n+  (NULL, 5)\n+  as t2(k, v);\n+\n+\n+-- Except operation that will be replaced by left anti join\n+SELECT * FROM t1 EXCEPT SELECT * FROM t2;",
    "line": 19
  }, {
    "author": {
      "login": "sathiyapk"
    },
    "body": "All verified via spark shell using `createOrReplaceTempView`",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-27T19:52:22Z",
    "diffHunk": "@@ -0,0 +1,57 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3),\n+  (\"one\", NULL)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5),\n+  (\"one\", NULL),\n+  (NULL, 5)\n+  as t2(k, v);\n+\n+\n+-- Except operation that will be replaced by left anti join\n+SELECT * FROM t1 EXCEPT SELECT * FROM t2;",
    "line": 19
  }, {
    "author": {
      "login": "sathiyapk"
    },
    "body": "And please let me know when it is right time to squash the commits..",
    "commit": "40d8797b1750d8a8814dcdc113fa79a3ab086cf2",
    "createdAt": "2017-10-27T19:53:42Z",
    "diffHunk": "@@ -0,0 +1,57 @@\n+-- Tests different scenarios of except operation\n+create temporary view t1 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 2),\n+  (\"three\", 3),\n+  (\"one\", NULL)\n+  as t1(k, v);\n+\n+create temporary view t2 as select * from values\n+  (\"one\", 1),\n+  (\"two\", 22),\n+  (\"one\", 5),\n+  (\"one\", NULL),\n+  (NULL, 5)\n+  as t2(k, v);\n+\n+\n+-- Except operation that will be replaced by left anti join\n+SELECT * FROM t1 EXCEPT SELECT * FROM t2;",
    "line": 19
  }],
  "prId": 19451
}]