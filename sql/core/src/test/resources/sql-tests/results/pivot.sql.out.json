[{
  "comments": [{
    "author": {
      "login": "gatorsmile"
    },
    "body": "?",
    "commit": "b27245e3e2ca021815e6b353036925e57f665e7a",
    "createdAt": "2018-07-08T05:50:22Z",
    "diffHunk": "@@ -144,51 +155,162 @@ PIVOT (\n   sum(earnings * s)\n   FOR course IN ('dotNET', 'Java')\n )\n--- !query 9 schema\n+-- !query 10 schema\n struct<year:int,dotNET:bigint,Java:bigint>\n--- !query 9 output\n+-- !query 10 output\n 2012\t15000\t20000\n 2013\t96000\t60000\n \n \n--- !query 10\n-SELECT 2012_s, 2013_s, 2012_a, 2013_a, c FROM (\n+-- !query 11\n+SELECT firstYear_s, secondYear_s, firstYear_a, secondYear_a, c FROM (\n   SELECT year y, course c, earnings e FROM courseSales\n )\n PIVOT (\n   sum(e) s, avg(e) a\n-  FOR y IN (2012, 2013)\n+  FOR y IN (2012 as firstYear, 2013 secondYear)\n )\n--- !query 10 schema\n-struct<2012_s:bigint,2013_s:bigint,2012_a:double,2013_a:double,c:string>\n--- !query 10 output\n+-- !query 11 schema\n+struct<firstYear_s:bigint,secondYear_s:bigint,firstYear_a:double,secondYear_a:double,c:string>\n+-- !query 11 output\n 15000\t48000\t7500.0\t48000.0\tdotNET\n 20000\t30000\t20000.0\t30000.0\tJava\n \n \n--- !query 11\n+-- !query 12\n SELECT * FROM courseSales\n PIVOT (\n   abs(earnings)\n   FOR year IN (2012, 2013)\n )\n--- !query 11 schema\n+-- !query 12 schema\n struct<>\n--- !query 11 output\n+-- !query 12 output\n org.apache.spark.sql.AnalysisException\n Aggregate expression required for pivot, found 'abs(earnings#x)';\n \n \n--- !query 12\n+-- !query 13\n SELECT * FROM (\n   SELECT course, earnings FROM courseSales\n )\n PIVOT (\n   sum(earnings)\n   FOR year IN (2012, 2013)\n )\n--- !query 12 schema\n+-- !query 13 schema\n struct<>\n--- !query 12 output\n+-- !query 13 output\n org.apache.spark.sql.AnalysisException\n cannot resolve '`year`' given input columns: [__auto_generated_subquery_name.course, __auto_generated_subquery_name.earnings]; line 4 pos 0\n+\n+\n+-- !query 14\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, year) IN (('dotNET', 2012), ('Java', 2013))\n+)\n+-- !query 14 schema\n+struct<s:int,[dotNET, 2012]:bigint,[Java, 2013]:bigint>\n+-- !query 14 output\n+1\t15000\tNULL\n+2\tNULL\t30000\n+\n+\n+-- !query 15\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, s) IN (('dotNET', 2) as c1, ('Java', 1) as c2)\n+)\n+-- !query 15 schema\n+struct<year:int,c1:bigint,c2:bigint>\n+-- !query 15 output\n+2012\tNULL\t20000\n+2013\t48000\tNULL\n+\n+\n+-- !query 16\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, year) IN ('dotNET', 'Java')\n+)\n+-- !query 16 schema\n+struct<>\n+-- !query 16 output\n+org.apache.spark.sql.AnalysisException\n+Invalid pivot value 'dotNET': value data type string does not match pivot column data type struct<course:string,year:int>;\n+\n+\n+-- !query 17\n+SELECT * FROM courseSales\n+PIVOT (\n+  sum(earnings)\n+  FOR year IN (s, 2013)\n+)\n+-- !query 17 schema\n+struct<>\n+-- !query 17 output\n+org.apache.spark.sql.AnalysisException\n+cannot resolve '`s`' given input columns: [coursesales.course, coursesales.year, coursesales.earnings]; line 4 pos 15\n+\n+\n+-- !query 18\n+SELECT * FROM courseSales\n+PIVOT (\n+  sum(earnings)\n+  FOR year IN (course, 2013)\n+)\n+-- !query 18 schema\n+struct<>\n+-- !query 18 output\n+org.apache.spark.sql.AnalysisException\n+Literal expressions required for pivot values, found 'course#x';\n+\n+\n+-- !query 19\n+SELECT * FROM (\n+  SELECT course, year, a\n+  FROM courseSales\n+  JOIN yearsWithArray ON year = y\n+)\n+PIVOT (\n+  min(a)\n+  FOR course IN ('dotNET', 'Java')\n+)\n+-- !query 19 schema\n+struct<>\n+-- !query 19 output\n+org.apache.spark.SparkException\n+Job 17 cancelled because SparkContext was shut down\n+\n+\n+-- !query 20\n+SELECT * FROM (\n+  SELECT course, year, y, a\n+  FROM courseSales\n+  JOIN yearsWithArray ON year = y\n+)\n+PIVOT (\n+  max(a)\n+  FOR (y, course) IN ((2012, 'dotNET'), (2013, 'Java'))\n+)\n+-- !query 20 schema\n+struct<>\n+-- !query 20 output\n+org.apache.spark.SparkException\n+Exception thrown in awaitResult:"
  }],
  "prId": 21720
}, {
  "comments": [{
    "author": {
      "login": "MaxGekk"
    },
    "body": "Is it expected output?",
    "commit": "b27245e3e2ca021815e6b353036925e57f665e7a",
    "createdAt": "2018-07-08T11:25:59Z",
    "diffHunk": "@@ -144,51 +155,162 @@ PIVOT (\n   sum(earnings * s)\n   FOR course IN ('dotNET', 'Java')\n )\n--- !query 9 schema\n+-- !query 10 schema\n struct<year:int,dotNET:bigint,Java:bigint>\n--- !query 9 output\n+-- !query 10 output\n 2012\t15000\t20000\n 2013\t96000\t60000\n \n \n--- !query 10\n-SELECT 2012_s, 2013_s, 2012_a, 2013_a, c FROM (\n+-- !query 11\n+SELECT firstYear_s, secondYear_s, firstYear_a, secondYear_a, c FROM (\n   SELECT year y, course c, earnings e FROM courseSales\n )\n PIVOT (\n   sum(e) s, avg(e) a\n-  FOR y IN (2012, 2013)\n+  FOR y IN (2012 as firstYear, 2013 secondYear)\n )\n--- !query 10 schema\n-struct<2012_s:bigint,2013_s:bigint,2012_a:double,2013_a:double,c:string>\n--- !query 10 output\n+-- !query 11 schema\n+struct<firstYear_s:bigint,secondYear_s:bigint,firstYear_a:double,secondYear_a:double,c:string>\n+-- !query 11 output\n 15000\t48000\t7500.0\t48000.0\tdotNET\n 20000\t30000\t20000.0\t30000.0\tJava\n \n \n--- !query 11\n+-- !query 12\n SELECT * FROM courseSales\n PIVOT (\n   abs(earnings)\n   FOR year IN (2012, 2013)\n )\n--- !query 11 schema\n+-- !query 12 schema\n struct<>\n--- !query 11 output\n+-- !query 12 output\n org.apache.spark.sql.AnalysisException\n Aggregate expression required for pivot, found 'abs(earnings#x)';\n \n \n--- !query 12\n+-- !query 13\n SELECT * FROM (\n   SELECT course, earnings FROM courseSales\n )\n PIVOT (\n   sum(earnings)\n   FOR year IN (2012, 2013)\n )\n--- !query 12 schema\n+-- !query 13 schema\n struct<>\n--- !query 12 output\n+-- !query 13 output\n org.apache.spark.sql.AnalysisException\n cannot resolve '`year`' given input columns: [__auto_generated_subquery_name.course, __auto_generated_subquery_name.earnings]; line 4 pos 0\n+\n+\n+-- !query 14\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, year) IN (('dotNET', 2012), ('Java', 2013))\n+)\n+-- !query 14 schema\n+struct<s:int,[dotNET, 2012]:bigint,[Java, 2013]:bigint>\n+-- !query 14 output\n+1\t15000\tNULL\n+2\tNULL\t30000\n+\n+\n+-- !query 15\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, s) IN (('dotNET', 2) as c1, ('Java', 1) as c2)\n+)\n+-- !query 15 schema\n+struct<year:int,c1:bigint,c2:bigint>\n+-- !query 15 output\n+2012\tNULL\t20000\n+2013\t48000\tNULL\n+\n+\n+-- !query 16\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, year) IN ('dotNET', 'Java')\n+)\n+-- !query 16 schema\n+struct<>\n+-- !query 16 output\n+org.apache.spark.sql.AnalysisException\n+Invalid pivot value 'dotNET': value data type string does not match pivot column data type struct<course:string,year:int>;\n+\n+\n+-- !query 17\n+SELECT * FROM courseSales\n+PIVOT (\n+  sum(earnings)\n+  FOR year IN (s, 2013)\n+)\n+-- !query 17 schema\n+struct<>\n+-- !query 17 output\n+org.apache.spark.sql.AnalysisException\n+cannot resolve '`s`' given input columns: [coursesales.course, coursesales.year, coursesales.earnings]; line 4 pos 15\n+\n+\n+-- !query 18\n+SELECT * FROM courseSales\n+PIVOT (\n+  sum(earnings)\n+  FOR year IN (course, 2013)\n+)\n+-- !query 18 schema\n+struct<>\n+-- !query 18 output\n+org.apache.spark.sql.AnalysisException\n+Literal expressions required for pivot values, found 'course#x';\n+\n+\n+-- !query 19\n+SELECT * FROM (\n+  SELECT course, year, a\n+  FROM courseSales\n+  JOIN yearsWithArray ON year = y\n+)\n+PIVOT (\n+  min(a)\n+  FOR course IN ('dotNET', 'Java')\n+)\n+-- !query 19 schema\n+struct<>\n+-- !query 19 output\n+org.apache.spark.SparkException\n+Job 17 cancelled because SparkContext was shut down"
  }, {
    "author": {
      "login": "maryannxue"
    },
    "body": "No... sorry about this. There must have been a mistake. I'll commit this file again.",
    "commit": "b27245e3e2ca021815e6b353036925e57f665e7a",
    "createdAt": "2018-07-09T20:31:15Z",
    "diffHunk": "@@ -144,51 +155,162 @@ PIVOT (\n   sum(earnings * s)\n   FOR course IN ('dotNET', 'Java')\n )\n--- !query 9 schema\n+-- !query 10 schema\n struct<year:int,dotNET:bigint,Java:bigint>\n--- !query 9 output\n+-- !query 10 output\n 2012\t15000\t20000\n 2013\t96000\t60000\n \n \n--- !query 10\n-SELECT 2012_s, 2013_s, 2012_a, 2013_a, c FROM (\n+-- !query 11\n+SELECT firstYear_s, secondYear_s, firstYear_a, secondYear_a, c FROM (\n   SELECT year y, course c, earnings e FROM courseSales\n )\n PIVOT (\n   sum(e) s, avg(e) a\n-  FOR y IN (2012, 2013)\n+  FOR y IN (2012 as firstYear, 2013 secondYear)\n )\n--- !query 10 schema\n-struct<2012_s:bigint,2013_s:bigint,2012_a:double,2013_a:double,c:string>\n--- !query 10 output\n+-- !query 11 schema\n+struct<firstYear_s:bigint,secondYear_s:bigint,firstYear_a:double,secondYear_a:double,c:string>\n+-- !query 11 output\n 15000\t48000\t7500.0\t48000.0\tdotNET\n 20000\t30000\t20000.0\t30000.0\tJava\n \n \n--- !query 11\n+-- !query 12\n SELECT * FROM courseSales\n PIVOT (\n   abs(earnings)\n   FOR year IN (2012, 2013)\n )\n--- !query 11 schema\n+-- !query 12 schema\n struct<>\n--- !query 11 output\n+-- !query 12 output\n org.apache.spark.sql.AnalysisException\n Aggregate expression required for pivot, found 'abs(earnings#x)';\n \n \n--- !query 12\n+-- !query 13\n SELECT * FROM (\n   SELECT course, earnings FROM courseSales\n )\n PIVOT (\n   sum(earnings)\n   FOR year IN (2012, 2013)\n )\n--- !query 12 schema\n+-- !query 13 schema\n struct<>\n--- !query 12 output\n+-- !query 13 output\n org.apache.spark.sql.AnalysisException\n cannot resolve '`year`' given input columns: [__auto_generated_subquery_name.course, __auto_generated_subquery_name.earnings]; line 4 pos 0\n+\n+\n+-- !query 14\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, year) IN (('dotNET', 2012), ('Java', 2013))\n+)\n+-- !query 14 schema\n+struct<s:int,[dotNET, 2012]:bigint,[Java, 2013]:bigint>\n+-- !query 14 output\n+1\t15000\tNULL\n+2\tNULL\t30000\n+\n+\n+-- !query 15\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, s) IN (('dotNET', 2) as c1, ('Java', 1) as c2)\n+)\n+-- !query 15 schema\n+struct<year:int,c1:bigint,c2:bigint>\n+-- !query 15 output\n+2012\tNULL\t20000\n+2013\t48000\tNULL\n+\n+\n+-- !query 16\n+SELECT * FROM (\n+  SELECT course, year, earnings, s\n+  FROM courseSales\n+  JOIN years ON year = y\n+)\n+PIVOT (\n+  sum(earnings)\n+  FOR (course, year) IN ('dotNET', 'Java')\n+)\n+-- !query 16 schema\n+struct<>\n+-- !query 16 output\n+org.apache.spark.sql.AnalysisException\n+Invalid pivot value 'dotNET': value data type string does not match pivot column data type struct<course:string,year:int>;\n+\n+\n+-- !query 17\n+SELECT * FROM courseSales\n+PIVOT (\n+  sum(earnings)\n+  FOR year IN (s, 2013)\n+)\n+-- !query 17 schema\n+struct<>\n+-- !query 17 output\n+org.apache.spark.sql.AnalysisException\n+cannot resolve '`s`' given input columns: [coursesales.course, coursesales.year, coursesales.earnings]; line 4 pos 15\n+\n+\n+-- !query 18\n+SELECT * FROM courseSales\n+PIVOT (\n+  sum(earnings)\n+  FOR year IN (course, 2013)\n+)\n+-- !query 18 schema\n+struct<>\n+-- !query 18 output\n+org.apache.spark.sql.AnalysisException\n+Literal expressions required for pivot values, found 'course#x';\n+\n+\n+-- !query 19\n+SELECT * FROM (\n+  SELECT course, year, a\n+  FROM courseSales\n+  JOIN yearsWithArray ON year = y\n+)\n+PIVOT (\n+  min(a)\n+  FOR course IN ('dotNET', 'Java')\n+)\n+-- !query 19 schema\n+struct<>\n+-- !query 19 output\n+org.apache.spark.SparkException\n+Job 17 cancelled because SparkContext was shut down"
  }],
  "prId": 21720
}]