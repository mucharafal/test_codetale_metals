[{
  "comments": [{
    "author": {
      "login": "davies"
    },
    "body": "cs_item_sk => ss_item_sk\n",
    "commit": "18150121df04c8f0fd39c2c2fbfbc7fc39ccbd64",
    "createdAt": "2016-05-19T23:33:31Z",
    "diffHunk": "@@ -0,0 +1,64 @@\n+WITH ws AS\n+(SELECT\n+    d_year AS ws_sold_year,\n+    ws_item_sk,\n+    ws_bill_customer_sk ws_customer_sk,\n+    sum(ws_quantity) ws_qty,\n+    sum(ws_wholesale_cost) ws_wc,\n+    sum(ws_sales_price) ws_sp\n+  FROM web_sales\n+    LEFT JOIN web_returns ON wr_order_number = ws_order_number AND ws_item_sk = wr_item_sk\n+    JOIN date_dim ON ws_sold_date_sk = d_date_sk\n+  WHERE wr_order_number IS NULL\n+  GROUP BY d_year, ws_item_sk, ws_bill_customer_sk\n+),\n+    cs AS\n+  (SELECT\n+    d_year AS cs_sold_year,\n+    cs_item_sk,\n+    cs_bill_customer_sk cs_customer_sk,\n+    sum(cs_quantity) cs_qty,\n+    sum(cs_wholesale_cost) cs_wc,\n+    sum(cs_sales_price) cs_sp\n+  FROM catalog_sales\n+    LEFT JOIN catalog_returns ON cr_order_number = cs_order_number AND cs_item_sk = cr_item_sk\n+    JOIN date_dim ON cs_sold_date_sk = d_date_sk\n+  WHERE cr_order_number IS NULL\n+  GROUP BY d_year, cs_item_sk, cs_bill_customer_sk\n+  ),\n+    ss AS\n+  (SELECT\n+    d_year AS ss_sold_year,\n+    ss_item_sk,\n+    ss_customer_sk,\n+    sum(ss_quantity) ss_qty,\n+    sum(ss_wholesale_cost) ss_wc,\n+    sum(ss_sales_price) ss_sp\n+  FROM store_sales\n+    LEFT JOIN store_returns ON sr_ticket_number = ss_ticket_number AND ss_item_sk = sr_item_sk\n+    JOIN date_dim ON ss_sold_date_sk = d_date_sk\n+  WHERE sr_ticket_number IS NULL\n+  GROUP BY d_year, ss_item_sk, ss_customer_sk\n+  )\n+SELECT\n+  round(ss_qty / (coalesce(ws_qty + cs_qty, 1)), 2) ratio,\n+  ss_qty store_qty,\n+  ss_wc store_wholesale_cost,\n+  ss_sp store_sales_price,\n+  coalesce(ws_qty, 0) + coalesce(cs_qty, 0) other_chan_qty,\n+  coalesce(ws_wc, 0) + coalesce(cs_wc, 0) other_chan_wholesale_cost,\n+  coalesce(ws_sp, 0) + coalesce(cs_sp, 0) other_chan_sales_price\n+FROM ss\n+  LEFT JOIN ws\n+    ON (ws_sold_year = ss_sold_year AND ws_item_sk = ss_item_sk AND ws_customer_sk = ss_customer_sk)\n+  LEFT JOIN cs\n+    ON (cs_sold_year = ss_sold_year AND cs_item_sk = cs_item_sk AND cs_customer_sk = ss_customer_sk)"
  }],
  "prId": 13188
}]