[{
  "comments": [{
    "author": {
      "login": "davies"
    },
    "body": "Could you move this FROM to the same line as SELECT?\n",
    "commit": "18150121df04c8f0fd39c2c2fbfbc7fc39ccbd64",
    "createdAt": "2016-05-19T23:23:41Z",
    "diffHunk": "@@ -0,0 +1,121 @@\n+WITH cross_items AS\n+(SELECT i_item_sk ss_item_sk\n+  FROM item,\n+    (SELECT\n+      iss.i_brand_id brand_id,\n+      iss.i_class_id class_id,\n+      iss.i_category_id category_id\n+    FROM store_sales, item iss, date_dim d1\n+    WHERE ss_item_sk = iss.i_item_sk\n+      AND ss_sold_date_sk = d1.d_date_sk\n+      AND d1.d_year BETWEEN 1999 AND 1999 + 2\n+    INTERSECT\n+    SELECT\n+      ics.i_brand_id,\n+      ics.i_class_id,\n+      ics.i_category_id\n+    FROM catalog_sales, item ics, date_dim d2\n+    WHERE cs_item_sk = ics.i_item_sk\n+      AND cs_sold_date_sk = d2.d_date_sk\n+      AND d2.d_year BETWEEN 1999 AND 1999 + 2\n+    INTERSECT\n+    SELECT\n+      iws.i_brand_id,\n+      iws.i_class_id,\n+      iws.i_category_id\n+    FROM web_sales, item iws, date_dim d3\n+    WHERE ws_item_sk = iws.i_item_sk\n+      AND ws_sold_date_sk = d3.d_date_sk\n+      AND d3.d_year BETWEEN 1999 AND 1999 + 2) x\n+  WHERE i_brand_id = brand_id\n+    AND i_class_id = class_id\n+    AND i_category_id = category_id\n+),\n+    avg_sales AS\n+  (SELECT avg(quantity * list_price) average_sales\n+  FROM (\n+         SELECT\n+           ss_quantity quantity,\n+           ss_list_price list_price\n+         FROM store_sales, date_dim\n+         WHERE ss_sold_date_sk = d_date_sk\n+           AND d_year BETWEEN 1999 AND 2001\n+         UNION ALL\n+         SELECT\n+           cs_quantity quantity,\n+           cs_list_price list_price\n+         FROM catalog_sales, date_dim\n+         WHERE cs_sold_date_sk = d_date_sk\n+           AND d_year BETWEEN 1999 AND 1999 + 2\n+         UNION ALL\n+         SELECT\n+           ws_quantity quantity,\n+           ws_list_price list_price\n+         FROM web_sales, date_dim\n+         WHERE ws_sold_date_sk = d_date_sk\n+           AND d_year BETWEEN 1999 AND 1999 + 2) x)\n+SELECT\n+  channel,\n+  i_brand_id,\n+  i_class_id,\n+  i_category_id,\n+  sum(sales),\n+  sum(number_sales)\n+FROM (\n+       SELECT\n+         'store' channel,\n+         i_brand_id,\n+         i_class_id,\n+         i_category_id,\n+         sum(ss_quantity * ss_list_price) sales,\n+         count(*) number_sales\n+       FROM store_sales, item, date_dim\n+       WHERE ss_item_sk IN (SELECT ss_item_sk\n+       FROM cross_items)\n+         AND ss_item_sk = i_item_sk\n+         AND ss_sold_date_sk = d_date_sk\n+         AND d_year = 1999 + 2\n+         AND d_moy = 11\n+       GROUP BY i_brand_id, i_class_id, i_category_id\n+       HAVING sum(ss_quantity * ss_list_price) > (SELECT average_sales\n+       FROM avg_sales)\n+       UNION ALL\n+       SELECT\n+         'catalog' channel,\n+         i_brand_id,\n+         i_class_id,\n+         i_category_id,\n+         sum(cs_quantity * cs_list_price) sales,\n+         count(*) number_sales\n+       FROM catalog_sales, item, date_dim\n+       WHERE cs_item_sk IN (SELECT ss_item_sk\n+       FROM cross_items)\n+         AND cs_item_sk = i_item_sk\n+         AND cs_sold_date_sk = d_date_sk\n+         AND d_year = 1999 + 2\n+         AND d_moy = 11\n+       GROUP BY i_brand_id, i_class_id, i_category_id\n+       HAVING sum(cs_quantity * cs_list_price) > (SELECT average_sales\n+       FROM avg_sales)"
  }],
  "prId": 13188
}]