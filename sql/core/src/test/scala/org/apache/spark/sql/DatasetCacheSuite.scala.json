[{
  "comments": [{
    "author": {
      "login": "viirya"
    },
    "body": "To test if it is eagerly persisted, why we need a collect here?",
    "commit": "31bf79742a219ca13cca2a6774da783b061864d1",
    "createdAt": "2017-07-24T03:00:23Z",
    "diffHunk": "@@ -25,9 +25,22 @@ import org.apache.spark.storage.StorageLevel\n class DatasetCacheSuite extends QueryTest with SharedSQLContext {\n   import testImplicits._\n \n-  // Clear all persistent datasets after each test\n   override def afterEach(): Unit = {\n-    spark.sharedState.cacheManager.clearCache()\n+    try {\n+      // Clear all persistent datasets after each test\n+      spark.sharedState.cacheManager.clearCache()\n+    } finally {\n+      super.afterEach()\n+    }\n+  }\n+\n+  test(\"eager persist\") {\n+    val ds = Seq(\"1\", \"2\").toDF()\n+    ds.persist(eager = false)\n+    assert(!ds.isMaterialized())\n+    ds.persist(eager = true)\n+    ds.collect()"
  }],
  "prId": 18717
}]