[{
  "comments": [{
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "Ur, is this correct? Previously, we had the followings.\r\n```\r\n     *Join w 2 ints codegen=false              4426 / 4501          4.7         211.1       1.0X\r\n     *Join w 2 ints codegen=true                791 /  818         26.5          37.7       5.6X\r\n```",
    "commit": "cd8b664e17ce613061cf046ee2b5c3f223c1afa7",
    "createdAt": "2018-10-11T09:16:46Z",
    "diffHunk": "@@ -0,0 +1,80 @@\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w long:                             Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long wholestage off                    4062 / 4709          5.2         193.7       1.0X\n+Join w long wholestage on                      152 /  163        138.4           7.2      26.8X\n+\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w long duplicated:                  Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long duplicated wholestage off         3793 / 3801          5.5         180.9       1.0X\n+Join w long duplicated wholestage on           207 /  219        101.1           9.9      18.3X\n+\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w 2 ints:                           Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w 2 ints wholestage off              138514 / 139178          0.2        6604.9       1.0X\n+Join w 2 ints wholestage on               129908 / 140869          0.2        6194.5       1.1X"
  }, {
    "author": {
      "login": "wangyum"
    },
    "body": "I think it's correct, I ran it on master:\r\n```\r\nbuild/sbt \"sql/test-only *benchmark.JoinBenchmark\"\r\n......\r\n[info] JoinBenchmark:\r\n[info] - broadcast hash join, long key !!! IGNORED !!!\r\n[info] - broadcast hash join, long key with duplicates !!! IGNORED !!!\r\nRunning benchmark: Join w 2 ints\r\n  Running case: Join w 2 ints wholestage off\r\n  Stopped after 2 iterations, 307335 ms\r\n  Running case: Join w 2 ints wholestage on\r\n  Stopped after 5 iterations, 687107 ms\r\n\r\nJava HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\r\nIntel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\r\n\r\nJoin w 2 ints:                           Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\r\n------------------------------------------------------------------------------------------------\r\nJoin w 2 ints wholestage off              153532 / 153668          0.1        7321.0       1.0X\r\nJoin w 2 ints wholestage on               132075 / 137422          0.2        6297.8       1.2X\r\n```",
    "commit": "cd8b664e17ce613061cf046ee2b5c3f223c1afa7",
    "createdAt": "2018-10-11T10:31:12Z",
    "diffHunk": "@@ -0,0 +1,80 @@\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w long:                             Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long wholestage off                    4062 / 4709          5.2         193.7       1.0X\n+Join w long wholestage on                      152 /  163        138.4           7.2      26.8X\n+\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w long duplicated:                  Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long duplicated wholestage off         3793 / 3801          5.5         180.9       1.0X\n+Join w long duplicated wholestage on           207 /  219        101.1           9.9      18.3X\n+\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w 2 ints:                           Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w 2 ints wholestage off              138514 / 139178          0.2        6604.9       1.0X\n+Join w 2 ints wholestage on               129908 / 140869          0.2        6194.5       1.1X"
  }, {
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "Oh, interesting. Although it's beyond the scope, could you run on `branch-2.4` and `branch-2.3` please, too?",
    "commit": "cd8b664e17ce613061cf046ee2b5c3f223c1afa7",
    "createdAt": "2018-10-11T16:41:09Z",
    "diffHunk": "@@ -0,0 +1,80 @@\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w long:                             Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long wholestage off                    4062 / 4709          5.2         193.7       1.0X\n+Join w long wholestage on                      152 /  163        138.4           7.2      26.8X\n+\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w long duplicated:                  Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long duplicated wholestage off         3793 / 3801          5.5         180.9       1.0X\n+Join w long duplicated wholestage on           207 /  219        101.1           9.9      18.3X\n+\n+Java HotSpot(TM) 64-Bit Server VM 1.8.0_151-b12 on Mac OS X 10.12.6\n+Intel(R) Core(TM) i7-7820HQ CPU @ 2.90GHz\n+\n+Join w 2 ints:                           Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w 2 ints wholestage off              138514 / 139178          0.2        6604.9       1.0X\n+Join w 2 ints wholestage on               129908 / 140869          0.2        6194.5       1.1X"
  }],
  "prId": 22661
}, {
  "comments": [{
    "author": {
      "login": "cloud-fan"
    },
    "body": "this surprises me that whole stage codegen doesn't help. We should investigate it later.",
    "commit": "cd8b664e17ce613061cf046ee2b5c3f223c1afa7",
    "createdAt": "2018-10-12T12:36:40Z",
    "diffHunk": "@@ -0,0 +1,75 @@\n+================================================================================================\n+Join Benchmark\n+================================================================================================\n+\n+OpenJDK 64-Bit Server VM 1.8.0_181-b13 on Linux 3.10.0-862.3.2.el7.x86_64\n+Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz\n+Join w long:                             Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long wholestage off                    4464 / 4483          4.7         212.9       1.0X\n+Join w long wholestage on                      289 /  339         72.6          13.8      15.5X\n+\n+OpenJDK 64-Bit Server VM 1.8.0_181-b13 on Linux 3.10.0-862.3.2.el7.x86_64\n+Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz\n+Join w long duplicated:                  Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long duplicated wholestage off         5662 / 5678          3.7         270.0       1.0X\n+Join w long duplicated wholestage on           332 /  345         63.1          15.8      17.0X\n+\n+OpenJDK 64-Bit Server VM 1.8.0_181-b13 on Linux 3.10.0-862.3.2.el7.x86_64\n+Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz\n+Join w 2 ints:                           Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w 2 ints wholestage off              173174 / 173183          0.1        8257.6       1.0X\n+Join w 2 ints wholestage on               166350 / 198362          0.1        7932.2       1.0X",
    "line": 24
  }, {
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "+1.",
    "commit": "cd8b664e17ce613061cf046ee2b5c3f223c1afa7",
    "createdAt": "2018-10-12T23:02:40Z",
    "diffHunk": "@@ -0,0 +1,75 @@\n+================================================================================================\n+Join Benchmark\n+================================================================================================\n+\n+OpenJDK 64-Bit Server VM 1.8.0_181-b13 on Linux 3.10.0-862.3.2.el7.x86_64\n+Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz\n+Join w long:                             Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long wholestage off                    4464 / 4483          4.7         212.9       1.0X\n+Join w long wholestage on                      289 /  339         72.6          13.8      15.5X\n+\n+OpenJDK 64-Bit Server VM 1.8.0_181-b13 on Linux 3.10.0-862.3.2.el7.x86_64\n+Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz\n+Join w long duplicated:                  Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w long duplicated wholestage off         5662 / 5678          3.7         270.0       1.0X\n+Join w long duplicated wholestage on           332 /  345         63.1          15.8      17.0X\n+\n+OpenJDK 64-Bit Server VM 1.8.0_181-b13 on Linux 3.10.0-862.3.2.el7.x86_64\n+Intel(R) Xeon(R) CPU E5-2670 v2 @ 2.50GHz\n+Join w 2 ints:                           Best/Avg Time(ms)    Rate(M/s)   Per Row(ns)   Relative\n+------------------------------------------------------------------------------------------------\n+Join w 2 ints wholestage off              173174 / 173183          0.1        8257.6       1.0X\n+Join w 2 ints wholestage on               166350 / 198362          0.1        7932.2       1.0X",
    "line": 24
  }],
  "prId": 22661
}]