[{
  "comments": [{
    "author": {
      "login": "liancheng"
    },
    "body": "How about catching exceptions thrown from `toSQL` and suggest the user to turn off native view and retry?\n",
    "commit": "43b4fe986fc98cc0024edb1abb6b1f446cf8ea4b",
    "createdAt": "2016-03-21T14:55:33Z",
    "diffHunk": "@@ -73,15 +68,18 @@ private[hive] case class CreateViewAsSelect(\n   }\n \n   private def prepareTable(sqlContext: SQLContext): CatalogTable = {\n-    val expandedText = if (sqlContext.conf.canonicalView) {\n-      try rebuildViewQueryString(sqlContext) catch {\n-        case NonFatal(e) => wrapViewTextWithSelect\n-      }\n+    val logicalPlan = if (tableDesc.schema.isEmpty) {\n+      child\n     } else {\n-      wrapViewTextWithSelect\n+      val projectList = childSchema.zip(tableDesc.schema).map {\n+        case (attr, col) => Alias(attr, col.name)()\n+      }\n+      sqlContext.executePlan(Project(projectList, child)).analyzed\n     }\n \n-    val viewSchema = {\n+    val viewText = new SQLBuilder(logicalPlan, sqlContext).toSQL",
    "line": 39
  }],
  "prId": 11860
}]