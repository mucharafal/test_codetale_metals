[{
  "comments": [{
    "author": {
      "login": "cloud-fan"
    },
    "body": "can we check the physical plan to make sure BroadcastJoin is picked?",
    "commit": "2189ce013b384a2f54df491ee14f815c2c932f20",
    "createdAt": "2019-01-10T09:58:22Z",
    "diffHunk": "@@ -91,4 +92,16 @@ class PruneFileSourcePartitionsSuite extends QueryTest with SQLTestUtils with Te\n       assert(size2 < tableStats.get.sizeInBytes)\n     }\n   }\n+\n+  test(\"SPARK-26576 Broadcast hint not applied to partitioned table\") {\n+    withTable(\"tbl\") {\n+      spark.range(10).selectExpr(\"id\", \"id % 3 as p\").write.partitionBy(\"p\").saveAsTable(\"tbl\")\n+\n+      val df = spark.table(\"tbl\")\n+      val hints = df.join(broadcast(df), \"p\").queryExecution.optimizedPlan.collect {"
  }, {
    "author": {
      "login": "maryannxue"
    },
    "body": "+1. And since master doesn't use ResolvedHint in optimization anymore, this issue doesn't exist in master, but figured it wouldn't hurt to add a test in master too.",
    "commit": "2189ce013b384a2f54df491ee14f815c2c932f20",
    "createdAt": "2019-01-10T16:21:09Z",
    "diffHunk": "@@ -91,4 +92,16 @@ class PruneFileSourcePartitionsSuite extends QueryTest with SQLTestUtils with Te\n       assert(size2 < tableStats.get.sizeInBytes)\n     }\n   }\n+\n+  test(\"SPARK-26576 Broadcast hint not applied to partitioned table\") {\n+    withTable(\"tbl\") {\n+      spark.range(10).selectExpr(\"id\", \"id % 3 as p\").write.partitionBy(\"p\").saveAsTable(\"tbl\")\n+\n+      val df = spark.table(\"tbl\")\n+      val hints = df.join(broadcast(df), \"p\").queryExecution.optimizedPlan.collect {"
  }, {
    "author": {
      "login": "jzhuge"
    },
    "body": "Fine with porting at least the unit test to master.",
    "commit": "2189ce013b384a2f54df491ee14f815c2c932f20",
    "createdAt": "2019-01-10T20:10:44Z",
    "diffHunk": "@@ -91,4 +92,16 @@ class PruneFileSourcePartitionsSuite extends QueryTest with SQLTestUtils with Te\n       assert(size2 < tableStats.get.sizeInBytes)\n     }\n   }\n+\n+  test(\"SPARK-26576 Broadcast hint not applied to partitioned table\") {\n+    withTable(\"tbl\") {\n+      spark.range(10).selectExpr(\"id\", \"id % 3 as p\").write.partitionBy(\"p\").saveAsTable(\"tbl\")\n+\n+      val df = spark.table(\"tbl\")\n+      val hints = df.join(broadcast(df), \"p\").queryExecution.optimizedPlan.collect {"
  }],
  "prId": 23507
}]