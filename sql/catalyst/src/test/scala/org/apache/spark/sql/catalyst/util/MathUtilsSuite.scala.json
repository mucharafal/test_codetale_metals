[{
  "comments": [{
    "author": {
      "login": "wzhfy"
    },
    "body": "Can you use the same cases from Oracle's doc? just to make sure we are getting the same results here.",
    "commit": "2e2b2ca39ffb595ec5c26bcec71afa9df8a612c6",
    "createdAt": "2017-06-22T02:59:34Z",
    "diffHunk": "@@ -0,0 +1,37 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.spark.sql.catalyst.util\n+\n+import org.apache.spark.SparkFunSuite\n+import org.apache.spark.sql.AnalysisException\n+import org.apache.spark.sql.catalyst.util.MathUtils._\n+\n+class MathUtilsSuite extends SparkFunSuite {\n+\n+  test(\"widthBucket\") {\n+    assert(widthBucket(5.35, 0.024, 10.06, 5) === 3)\n+    assert(widthBucket(99, 100, 5000, 10) === 0)\n+    assert(widthBucket(100, 100, 5000, 10) === 1)\n+    assert(widthBucket(590, 100, 5000, 10) === 2)\n+    assert(widthBucket(5000, 100, 5000, 10) === 11)\n+    assert(widthBucket(6000, 100, 5000, 10) === 11)"
  }],
  "prId": 18323
}, {
  "comments": [{
    "author": {
      "login": "wzhfy"
    },
    "body": "Is this behavior consistent with other databases? If so, then I'm fine with this and please ignore my previous comment.",
    "commit": "2e2b2ca39ffb595ec5c26bcec71afa9df8a612c6",
    "createdAt": "2017-06-26T06:47:05Z",
    "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.spark.sql.catalyst.util\n+\n+import org.apache.spark.SparkFunSuite\n+import org.apache.spark.sql.AnalysisException\n+import org.apache.spark.sql.catalyst.util.MathUtils._\n+\n+class MathUtilsSuite extends SparkFunSuite {\n+\n+  test(\"widthBucket\") {\n+    assert(widthBucket(5.35, 0.024, 10.06, 5) === 3)\n+    assert(widthBucket(0, 1, 1, 1) === 0)\n+    assert(widthBucket(20, 1, 1, 1) === 2)\n+\n+    // Test https://docs.oracle.com/cd/B28359_01/olap.111/b28126/dml_functions_2137.htm#OLADM717\n+    // WIDTH_BUCKET(credit_limit, 100, 5000, 10)\n+    assert(widthBucket(500, 100, 5000, 10) === 1)\n+    assert(widthBucket(2300, 100, 5000, 10) === 5)\n+    assert(widthBucket(3500, 100, 5000, 10) === 7)\n+    assert(widthBucket(1200, 100, 5000, 10) === 3)\n+    assert(widthBucket(1400, 100, 5000, 10) === 3)\n+    assert(widthBucket(700, 100, 5000, 10) === 2)\n+    assert(widthBucket(5000, 100, 5000, 10) === 11)\n+    assert(widthBucket(1800, 100, 5000, 10) === 4)\n+    assert(widthBucket(400, 100, 5000, 10) === 1)\n+\n+    // minValue == maxValue\n+    assert(widthBucket(10, 4, 4, 15) === 16)",
    "line": 44
  }, {
    "author": {
      "login": "wangyum"
    },
    "body": "Yes, This is Oracle's behavior:\r\n![oracle-width_bucket](https://user-images.githubusercontent.com/5399861/27527840-235cc452-5a80-11e7-99ff-90c0f10e2eb7.gif)\r\n",
    "commit": "2e2b2ca39ffb595ec5c26bcec71afa9df8a612c6",
    "createdAt": "2017-06-26T07:00:39Z",
    "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.spark.sql.catalyst.util\n+\n+import org.apache.spark.SparkFunSuite\n+import org.apache.spark.sql.AnalysisException\n+import org.apache.spark.sql.catalyst.util.MathUtils._\n+\n+class MathUtilsSuite extends SparkFunSuite {\n+\n+  test(\"widthBucket\") {\n+    assert(widthBucket(5.35, 0.024, 10.06, 5) === 3)\n+    assert(widthBucket(0, 1, 1, 1) === 0)\n+    assert(widthBucket(20, 1, 1, 1) === 2)\n+\n+    // Test https://docs.oracle.com/cd/B28359_01/olap.111/b28126/dml_functions_2137.htm#OLADM717\n+    // WIDTH_BUCKET(credit_limit, 100, 5000, 10)\n+    assert(widthBucket(500, 100, 5000, 10) === 1)\n+    assert(widthBucket(2300, 100, 5000, 10) === 5)\n+    assert(widthBucket(3500, 100, 5000, 10) === 7)\n+    assert(widthBucket(1200, 100, 5000, 10) === 3)\n+    assert(widthBucket(1400, 100, 5000, 10) === 3)\n+    assert(widthBucket(700, 100, 5000, 10) === 2)\n+    assert(widthBucket(5000, 100, 5000, 10) === 11)\n+    assert(widthBucket(1800, 100, 5000, 10) === 4)\n+    assert(widthBucket(400, 100, 5000, 10) === 1)\n+\n+    // minValue == maxValue\n+    assert(widthBucket(10, 4, 4, 15) === 16)",
    "line": 44
  }, {
    "author": {
      "login": "wzhfy"
    },
    "body": "Thanks!",
    "commit": "2e2b2ca39ffb595ec5c26bcec71afa9df8a612c6",
    "createdAt": "2017-06-26T07:26:29Z",
    "diffHunk": "@@ -0,0 +1,51 @@\n+/*\n+ * Licensed to the Apache Software Foundation (ASF) under one or more\n+ * contributor license agreements.  See the NOTICE file distributed with\n+ * this work for additional information regarding copyright ownership.\n+ * The ASF licenses this file to You under the Apache License, Version 2.0\n+ * (the \"License\"); you may not use this file except in compliance with\n+ * the License.  You may obtain a copy of the License at\n+ *\n+ *    http://www.apache.org/licenses/LICENSE-2.0\n+ *\n+ * Unless required by applicable law or agreed to in writing, software\n+ * distributed under the License is distributed on an \"AS IS\" BASIS,\n+ * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n+ * See the License for the specific language governing permissions and\n+ * limitations under the License.\n+ */\n+\n+package org.apache.spark.sql.catalyst.util\n+\n+import org.apache.spark.SparkFunSuite\n+import org.apache.spark.sql.AnalysisException\n+import org.apache.spark.sql.catalyst.util.MathUtils._\n+\n+class MathUtilsSuite extends SparkFunSuite {\n+\n+  test(\"widthBucket\") {\n+    assert(widthBucket(5.35, 0.024, 10.06, 5) === 3)\n+    assert(widthBucket(0, 1, 1, 1) === 0)\n+    assert(widthBucket(20, 1, 1, 1) === 2)\n+\n+    // Test https://docs.oracle.com/cd/B28359_01/olap.111/b28126/dml_functions_2137.htm#OLADM717\n+    // WIDTH_BUCKET(credit_limit, 100, 5000, 10)\n+    assert(widthBucket(500, 100, 5000, 10) === 1)\n+    assert(widthBucket(2300, 100, 5000, 10) === 5)\n+    assert(widthBucket(3500, 100, 5000, 10) === 7)\n+    assert(widthBucket(1200, 100, 5000, 10) === 3)\n+    assert(widthBucket(1400, 100, 5000, 10) === 3)\n+    assert(widthBucket(700, 100, 5000, 10) === 2)\n+    assert(widthBucket(5000, 100, 5000, 10) === 11)\n+    assert(widthBucket(1800, 100, 5000, 10) === 4)\n+    assert(widthBucket(400, 100, 5000, 10) === 1)\n+\n+    // minValue == maxValue\n+    assert(widthBucket(10, 4, 4, 15) === 16)",
    "line": 44
  }],
  "prId": 18323
}]