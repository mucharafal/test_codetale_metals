[{
  "comments": [{
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "Since this `PartialFunction` is passed to `transformDown`, we don't need this `case other => other`. Please remove line 191 ~ 192.",
    "commit": "982741e5b5a5baede9c514bed98c9528f34e3326",
    "createdAt": "2019-04-01T01:27:20Z",
    "diffHunk": "@@ -175,30 +175,24 @@ object ObjectSerializerPruning extends Rule[LogicalPlan] {\n       serializer: NamedExpression,\n       prunedDataType: DataType): NamedExpression = {\n     val prunedStructTypes = collectStructType(prunedDataType, ArrayBuffer.empty[StructType])\n-    var structTypeIndex = 0\n+      .toIterator\n \n-    val transformedSerializer = serializer.transformDown {\n+    def transformer: PartialFunction[Expression, Expression] = {\n       case m: ExternalMapToCatalyst =>\n-        val prunedKeyConverter = m.keyConverter.transformDown {\n-          case s: CreateNamedStruct if structTypeIndex < prunedStructTypes.size =>\n-            val prunedType = prunedStructTypes(structTypeIndex)\n-            structTypeIndex += 1\n-            pruneNamedStruct(s, prunedType)\n-        }\n-        val prunedValueConverter = m.valueConverter.transformDown {\n-          case s: CreateNamedStruct if structTypeIndex < prunedStructTypes.size =>\n-            val prunedType = prunedStructTypes(structTypeIndex)\n-            structTypeIndex += 1\n-            pruneNamedStruct(s, prunedType)\n-        }\n+        val prunedKeyConverter = m.keyConverter.transformDown(transformer)\n+        val prunedValueConverter = m.valueConverter.transformDown(transformer)\n+\n         m.copy(keyConverter = alignNullTypeInIf(prunedKeyConverter),\n           valueConverter = alignNullTypeInIf(prunedValueConverter))\n-      case s: CreateNamedStruct if structTypeIndex < prunedStructTypes.size =>\n-        val prunedType = prunedStructTypes(structTypeIndex)\n-        structTypeIndex += 1\n+\n+      case s: CreateNamedStruct if prunedStructTypes.hasNext =>\n+        val prunedType = prunedStructTypes.next()\n         pruneNamedStruct(s, prunedType)\n+\n+      case other => other"
  }],
  "prId": 24260
}]