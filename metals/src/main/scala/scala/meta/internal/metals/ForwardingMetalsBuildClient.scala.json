[
  {
    "id" : "64fe9960-0f97-4494-ad74-10511ce0762a",
    "prId" : 720,
    "comments" : [
      {
        "id" : "33487f59-b8f8-43ec-b3fd-767879b66ddb",
        "parentId" : null,
        "author" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "body" : "`mainClasses: MainClasses`",
        "createdAt" : "2019-05-15T13:51:19Z",
        "updatedAt" : "2019-05-16T11:54:05Z",
        "lastEditedBy" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "0a41f90a-162a-43a5-b1f7-62d4379d8a2d",
        "parentId" : "33487f59-b8f8-43ec-b3fd-767879b66ddb",
        "author" : {
          "login" : "marek1840",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/3709537?u=2bdae30d4b911a57f5cb033e41831a6373de88bb&v=4"
        },
        "body" : "`entryPoints: JvmEntryPoints` ? ",
        "createdAt" : "2019-05-15T14:18:10Z",
        "updatedAt" : "2019-05-16T11:54:05Z",
        "lastEditedBy" : {
          "login" : "marek1840",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/3709537?u=2bdae30d4b911a57f5cb033e41831a6373de88bb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "b142f5cd4b8e8230bbc6afa68fbe49c21214b35d",
    "line" : null,
    "diffHunk" : "@@ -27,7 +27,8 @@ final class ForwardingMetalsBuildClient(\n     config: MetalsServerConfig,\n     statusBar: StatusBar,\n     time: Time,\n-    didCompile: CompileReport => Unit\n+    didCompile: CompileReport => Unit,\n+    cache: PostCompileCache"
  },
  {
    "id" : "44a9796a-926e-4e2c-928f-feea18347ae4",
    "prId" : 720,
    "comments" : [
      {
        "id" : "fabcfaa5-2fbc-460a-8e25-3bfc33d3c4cc",
        "parentId" : null,
        "author" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "body" : "`mainClasses.onDidChange(target)`",
        "createdAt" : "2019-05-15T13:51:33Z",
        "updatedAt" : "2019-05-16T11:54:05Z",
        "lastEditedBy" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "b142f5cd4b8e8230bbc6afa68fbe49c21214b35d",
    "line" : null,
    "diffHunk" : "@@ -131,6 +132,9 @@ final class ForwardingMetalsBuildClient(\n           if (!compilation.isNoOp) {\n             scribe.info(s\"time: compiled $name in ${compilation.timer}\")\n           }\n+          if (isSuccess && (!cache.isInitialized || !compilation.isNoOp)) {\n+            cache.initialize(target)"
  },
  {
    "id" : "42652ae1-39e5-4a5c-a928-c65fdd79973b",
    "prId" : 797,
    "comments" : [
      {
        "id" : "58887f08-5bf1-4225-b135-cbe135a1bfa6",
        "parentId" : null,
        "author" : {
          "login" : "marek1840",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/3709537?u=2bdae30d4b911a57f5cb033e41831a6373de88bb&v=4"
        },
        "body" : "I'm not sure the presentation logic should be held together with the \"business\" logic. ",
        "createdAt" : "2019-06-27T07:04:47Z",
        "updatedAt" : "2019-06-28T12:28:04Z",
        "lastEditedBy" : {
          "login" : "marek1840",
          "name" : null,
          "avatarUrl" : "https://avatars1.githubusercontent.com/u/3709537?u=2bdae30d4b911a57f5cb033e41831a6373de88bb&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "9bef3b6f-7c83-415f-b412-6ed5ff2ee65f",
        "parentId" : "58887f08-5bf1-4225-b135-cbe135a1bfa6",
        "author" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "body" : "I agree with you, will try to move this logic to the tree view provider.",
        "createdAt" : "2019-06-27T09:14:04Z",
        "updatedAt" : "2019-06-28T12:28:04Z",
        "lastEditedBy" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "f3a4ae4e-251d-46c0-8ffe-c05d5896dea7",
        "parentId" : "58887f08-5bf1-4225-b135-cbe135a1bfa6",
        "author" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "body" : "OK, it required a decent bit of refactoring but I think it's a lot cleaner now. All the UI logic is now contained in the tree view provider and the tree view provider no longer depends on `buildClient: MetalsBuildClient`.",
        "createdAt" : "2019-06-27T12:51:16Z",
        "updatedAt" : "2019-06-28T12:28:04Z",
        "lastEditedBy" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a43e250d79a91a6cadd98f502fb91b0993c3b5d8",
    "line" : null,
    "diffHunk" : "@@ -174,4 +183,50 @@ final class ForwardingMetalsBuildClient(\n       case _ =>\n     }\n   }\n+\n+  def ongoingCompilations: Array[TreeViewNode] = {\n+    compilations.keysIterator.flatMap(ongoingCompileNode).toArray\n+  }\n+\n+  def ongoingCompileNode("
  },
  {
    "id" : "9add5307-1024-4079-8a7f-fd900f5718d8",
    "prId" : 923,
    "comments" : [
      {
        "id" : "bfcb3c49-b204-4dac-b602-bde601f4d23c",
        "parentId" : null,
        "author" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "body" : "Can we keep the structure of imports - turn off import formatting in Intellij?",
        "createdAt" : "2019-09-18T10:08:02Z",
        "updatedAt" : "2019-09-24T10:49:11Z",
        "lastEditedBy" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "34b736c65504efc71e34421317b1346d8671e0ea",
    "line" : null,
    "diffHunk" : "@@ -1,19 +1,16 @@\n package scala.meta.internal.metals\n \n-import ch.epfl.scala.bsp4j.BuildTargetIdentifier\n-import ch.epfl.scala.bsp4j.CompileReport\n-import ch.epfl.scala.bsp4j.TaskDataKind\n-import ch.epfl.scala.bsp4j.TaskFinishParams\n-import ch.epfl.scala.bsp4j.TaskProgressParams\n-import ch.epfl.scala.bsp4j.TaskStartParams\n-import ch.epfl.scala.{bsp4j => b}\n-import com.google.gson.JsonObject\n import java.util.Collections\n import java.util.concurrent.ConcurrentHashMap\n+\n+import ch.epfl.scala.bsp4j._\n+import ch.epfl.scala.{bsp4j => b}\n+import com.google.gson.JsonObject\n import org.eclipse.lsp4j.jsonrpc.services.JsonNotification\n import org.eclipse.{lsp4j => l}\n+\n import scala.collection.concurrent.TrieMap\n-import scala.concurrent.Promise\n+import scala.concurrent.{ExecutionContext, Promise}"
  },
  {
    "id" : "459e7cee-6dcd-4034-a42f-8b39fedf970c",
    "prId" : 923,
    "comments" : [
      {
        "id" : "7e843770-6141-4d2a-9cf5-7f956de2ea6c",
        "parentId" : null,
        "author" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "body" : "Can we make the execution context explicit here too?",
        "createdAt" : "2019-09-18T10:08:29Z",
        "updatedAt" : "2019-09-24T10:49:11Z",
        "lastEditedBy" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "tags" : [
        ]
      }
    ],
    "commit" : "34b736c65504efc71e34421317b1346d8671e0ea",
    "line" : 38,
    "diffHunk" : "@@ -24,12 +21,15 @@ final class ForwardingMetalsBuildClient(\n     languageClient: MetalsLanguageClient,\n     diagnostics: Diagnostics,\n     buildTargets: BuildTargets,\n+    buildTargetClasses: BuildTargetClasses,\n     config: MetalsServerConfig,\n     statusBar: StatusBar,\n     time: Time,\n     didCompile: CompileReport => Unit,\n-    treeViewProvider: () => TreeViewProvider\n-) extends MetalsBuildClient\n+    treeViewProvider: () => TreeViewProvider,\n+    isCurrentlyOpened: b.BuildTargetIdentifier => Boolean\n+)(implicit ec: ExecutionContext)"
  },
  {
    "id" : "3e30ff84-4425-4bcf-af1d-736dd485bfa4",
    "prId" : 942,
    "comments" : [
      {
        "id" : "252e67f7-7350-4b66-b69a-9ce87f75bddb",
        "parentId" : null,
        "author" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "body" : "nit: `filter` should generally be avoided on `Future` values because it makes the `Future` fail, it's better to do this instead\r\n\r\n```scala\r\nrebuildIndex().foreach { _ =>\r\n  if (foo()) { doBar() }\r\n}\r\n```",
        "createdAt" : "2019-09-29T22:09:34Z",
        "updatedAt" : "2019-10-04T07:32:50Z",
        "lastEditedBy" : {
          "login" : "olafurpg",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/1408093?v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "47ea581fbaa603a2dc171e3e913392f05fc4ba11",
    "line" : null,
    "diffHunk" : "@@ -139,6 +141,11 @@ final class ForwardingMetalsBuildClient(\n             scribe.info(s\"time: compiled $name in ${compilation.timer}\")\n           }\n           if (isSuccess) {\n+            buildTargetClasses\n+              .rebuildIndex(target)\n+              .filter(_ => isCurrentlyFocused(target))"
  },
  {
    "id" : "c82374c1-795c-48d0-af21-360af6489604",
    "prId" : 1658,
    "comments" : [
      {
        "id" : "78a94942-ed59-4377-990d-4a85c3f167cb",
        "parentId" : null,
        "author" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "body" : "I wonder if we should just check all targets that we depend on when running a particular class :thinking: ",
        "createdAt" : "2020-04-23T11:51:06Z",
        "updatedAt" : "2020-04-27T16:10:09Z",
        "lastEditedBy" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "39619d32-6b4a-47a0-ab1d-f17ce4b68ef3",
        "parentId" : "78a94942-ed59-4377-990d-4a85c3f167cb",
        "author" : {
          "login" : "ckipp01",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/13974112?u=7b6a2ddab8eec6f99e4e40ae9b81f71cb5ba92e5&v=4"
        },
        "body" : "Probably right? Because if not the same issue will still occur won't it?",
        "createdAt" : "2020-04-23T19:42:43Z",
        "updatedAt" : "2020-04-27T16:10:09Z",
        "lastEditedBy" : {
          "login" : "ckipp01",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/13974112?u=7b6a2ddab8eec6f99e4e40ae9b81f71cb5ba92e5&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a85757ad79d2c98e7698e8eb798381fc1936ad30",
    "line" : null,
    "diffHunk" : "@@ -52,6 +52,8 @@ final class ForwardingMetalsBuildClient(\n   val updatedTreeViews: ju.Set[BuildTargetIdentifier] =\n     ConcurrentHashSet.empty[BuildTargetIdentifier]\n \n+  def buildHasErrors = !hasReportedError.isEmpty()"
  },
  {
    "id" : "1f70fb59-0dba-4900-8cc2-79f7e0fcd147",
    "prId" : 1658,
    "comments" : [
      {
        "id" : "611c4794-daa5-43d9-b6f5-26a55d2d5267",
        "parentId" : null,
        "author" : {
          "login" : "kpbochenek",
          "name" : null,
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/10478402?u=7a7840d3f5ce4047a19639e6b7977d43e3557158&v=4"
        },
        "body" : "if you don't find it less readable you can do `exists(hasReportedError.contains)`",
        "createdAt" : "2020-04-27T12:23:57Z",
        "updatedAt" : "2020-04-27T16:10:09Z",
        "lastEditedBy" : {
          "login" : "kpbochenek",
          "name" : null,
          "avatarUrl" : "https://avatars2.githubusercontent.com/u/10478402?u=7a7840d3f5ce4047a19639e6b7977d43e3557158&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "e559876a-856b-4a7a-a77f-8bb5aff375e0",
        "parentId" : "611c4794-daa5-43d9-b6f5-26a55d2d5267",
        "author" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "body" : "It's a java set, so I can't do it the other way.",
        "createdAt" : "2020-04-27T12:54:58Z",
        "updatedAt" : "2020-04-27T16:10:09Z",
        "lastEditedBy" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      },
      {
        "id" : "59cf2e9a-dfea-4e11-ae71-1567e8e0f7df",
        "parentId" : "611c4794-daa5-43d9-b6f5-26a55d2d5267",
        "author" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "body" : "changed to `exists(hasReportedError.contains(_))`",
        "createdAt" : "2020-04-27T13:38:55Z",
        "updatedAt" : "2020-04-27T16:10:09Z",
        "lastEditedBy" : {
          "login" : "tgodzik",
          "name" : null,
          "avatarUrl" : "https://avatars0.githubusercontent.com/u/3807253?u=094831e6a696f583ddfd86d3e5923fd8545c543a&v=4"
        },
        "tags" : [
          {
            "value" : "outdated"
          }
        ]
      }
    ],
    "commit" : "a85757ad79d2c98e7698e8eb798381fc1936ad30",
    "line" : null,
    "diffHunk" : "@@ -52,6 +52,14 @@ final class ForwardingMetalsBuildClient(\n   val updatedTreeViews: ju.Set[BuildTargetIdentifier] =\n     ConcurrentHashSet.empty[BuildTargetIdentifier]\n \n+  def buildHasErrors(buildTargetId: BuildTargetIdentifier): Boolean = {\n+    buildTargets\n+      .buildTargetTransitiveDependencies(buildTargetId)\n+      .exists(id => hasReportedError.contains(id))"
  }
]