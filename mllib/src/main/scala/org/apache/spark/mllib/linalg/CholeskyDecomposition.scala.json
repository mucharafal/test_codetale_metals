[{
  "comments": [{
    "author": {
      "login": "srowen"
    },
    "body": "CC @yanboliang -- tried to add more to the error messages here, and distinguish between unsupported input (illegal argument) and bad call to LAPACK (illegal state? an assertion error seemed like too much)\n",
    "commit": "e76886592f928644b2c0787dd8987aaedc2fb1fc",
    "createdAt": "2016-09-21T08:38:42Z",
    "diffHunk": "@@ -52,8 +51,20 @@ private[spark] object CholeskyDecomposition {\n   def inverse(UAi: Array[Double], k: Int): Array[Double] = {\n     val info = new intW(0)\n     lapack.dpptri(\"U\", k, UAi, info)\n-    val code = info.`val`\n-    assert(code == 0, s\"lapack.dpptri returned $code.\")\n+    checkReturnValue(info, \"dpptri\")\n     UAi\n   }\n+\n+  private def checkReturnValue(info: intW, method: String): Unit = {",
    "line": 20
  }],
  "prId": 15177
}, {
  "comments": [{
    "author": {
      "login": "yanboliang"
    },
    "body": "Should we output `arg ${-code}`? Since the arguments is internal used and MLlib users have no sense of them and can do nothing to verify it. If the arguments of `dppsv` is illegal, it should be caused by bugs of MLlib.\n",
    "commit": "e76886592f928644b2c0787dd8987aaedc2fb1fc",
    "createdAt": "2016-09-21T09:01:10Z",
    "diffHunk": "@@ -52,8 +51,20 @@ private[spark] object CholeskyDecomposition {\n   def inverse(UAi: Array[Double], k: Int): Array[Double] = {\n     val info = new intW(0)\n     lapack.dpptri(\"U\", k, UAi, info)\n-    val code = info.`val`\n-    assert(code == 0, s\"lapack.dpptri returned $code.\")\n+    checkReturnValue(info, \"dpptri\")\n     UAi\n   }\n+\n+  private def checkReturnValue(info: intW, method: String): Unit = {\n+    info.`val` match {\n+      case code if code < 0 =>\n+        throw new IllegalStateException(s\"LAPACK.$method returned $code; arg ${-code} is illegal\")",
    "line": 23
  }, {
    "author": {
      "login": "srowen"
    },
    "body": "Yes, none of this info is really useful to the end user in this case because it's a bug. It may be useful in an error report. I figured it's worth saying _something_ and why not say a little more about the cause to help anyone who cares save the step of looking up what \"-2\" means.\n",
    "commit": "e76886592f928644b2c0787dd8987aaedc2fb1fc",
    "createdAt": "2016-09-21T09:11:07Z",
    "diffHunk": "@@ -52,8 +51,20 @@ private[spark] object CholeskyDecomposition {\n   def inverse(UAi: Array[Double], k: Int): Array[Double] = {\n     val info = new intW(0)\n     lapack.dpptri(\"U\", k, UAi, info)\n-    val code = info.`val`\n-    assert(code == 0, s\"lapack.dpptri returned $code.\")\n+    checkReturnValue(info, \"dpptri\")\n     UAi\n   }\n+\n+  private def checkReturnValue(info: intW, method: String): Unit = {\n+    info.`val` match {\n+      case code if code < 0 =>\n+        throw new IllegalStateException(s\"LAPACK.$method returned $code; arg ${-code} is illegal\")",
    "line": 23
  }],
  "prId": 15177
}]