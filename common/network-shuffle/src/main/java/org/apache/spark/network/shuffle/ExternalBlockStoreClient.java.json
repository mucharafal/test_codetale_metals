[{
  "comments": [{
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "Do we need to use `WARN` level? It looks a little high.",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T03:52:43Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.\n+            if (clientFactory != null) {\n+              TransportClient client = clientFactory.createClient(host, port);\n+              new OneForOneBlockFetcher(client, appId, execId,\n+                      blockIds1, listener1, conf, downloadFileManager).start();\n+            } else {\n+              logger.warn(\"This client was closed. Skipping further block fetch retries.\");"
  }, {
    "author": {
      "login": "viirya"
    },
    "body": "info? debug?",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T04:13:23Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.\n+            if (clientFactory != null) {\n+              TransportClient client = clientFactory.createClient(host, port);\n+              new OneForOneBlockFetcher(client, appId, execId,\n+                      blockIds1, listener1, conf, downloadFileManager).start();\n+            } else {\n+              logger.warn(\"This client was closed. Skipping further block fetch retries.\");"
  }, {
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "I guess `INFO` is enough.",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T04:44:34Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.\n+            if (clientFactory != null) {\n+              TransportClient client = clientFactory.createClient(host, port);\n+              new OneForOneBlockFetcher(client, appId, execId,\n+                      blockIds1, listener1, conf, downloadFileManager).start();\n+            } else {\n+              logger.warn(\"This client was closed. Skipping further block fetch retries.\");"
  }],
  "prId": 26115
}, {
  "comments": [{
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "`this client` -> `this clientFactory`?",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T03:59:10Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.",
    "line": 16
  }, {
    "author": {
      "login": "viirya"
    },
    "body": "`This client` here means ExternalBlockStoreClient, not the clientFactory. ",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T04:09:50Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.",
    "line": 16
  }, {
    "author": {
      "login": "dongjoon-hyun"
    },
    "body": "Does it match with the code `if (clientFactory != null) {`?",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T04:45:10Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.",
    "line": 16
  }, {
    "author": {
      "login": "viirya"
    },
    "body": "I am fine for clientFactory, although I concern it sounds a bit not easy to understand, for end users. ",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T05:00:58Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.",
    "line": 16
  }, {
    "author": {
      "login": "viirya"
    },
    "body": "Changed to clientFactory.",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T05:01:31Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.",
    "line": 16
  }],
  "prId": 26115
}, {
  "comments": [{
    "author": {
      "login": "cloud-fan"
    },
    "body": "shall we mark `clientFactory` as `transient`? Seems like the thread to close the client and the thread to retry can be different.",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T07:15:26Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.\n+            if (clientFactory != null) {",
    "line": 17
  }, {
    "author": {
      "login": "viirya"
    },
    "body": "you mean volatile?",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T15:19:57Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.\n+            if (clientFactory != null) {",
    "line": 17
  }, {
    "author": {
      "login": "cloud-fan"
    },
    "body": "ah sorry, `volatile`",
    "commit": "730708d2376c8b3e7e8f9d97e7ec5daf7a1909aa",
    "createdAt": "2019-10-15T16:19:22Z",
    "diffHunk": "@@ -102,9 +102,14 @@ public void fetchBlocks(\n     try {\n       RetryingBlockFetcher.BlockFetchStarter blockFetchStarter =\n           (blockIds1, listener1) -> {\n-            TransportClient client = clientFactory.createClient(host, port);\n-            new OneForOneBlockFetcher(client, appId, execId,\n-              blockIds1, listener1, conf, downloadFileManager).start();\n+            // Unless this client is closed.\n+            if (clientFactory != null) {",
    "line": 17
  }],
  "prId": 26115
}]