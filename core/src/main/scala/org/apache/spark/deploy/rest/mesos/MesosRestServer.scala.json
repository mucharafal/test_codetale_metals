[{
  "comments": [{
    "author": {
      "login": "sarutak"
    },
    "body": "How about compare by `==` instead of `equals` ?\n",
    "commit": "c3cd3323fbe242504913effb8c56fe230b9a15b8",
    "createdAt": "2015-12-17T16:48:29Z",
    "diffHunk": "@@ -99,7 +99,7 @@ private[mesos] class MesosSubmitRequestServlet(\n     // cause spark-submit script to look for files in SPARK_HOME instead.\n     // We only need the ability to specify where to find spark-submit script\n     // which user can user spark.executor.home or spark.home configurations.\n-    val environmentVariables = request.environmentVariables.filter(!_.equals(\"SPARK_HOME\"))\n+    val environmentVariables = request.environmentVariables.filterKeys(!_.equals(\"SPARK_HOME\"))",
    "line": 5
  }, {
    "author": {
      "login": "dragos"
    },
    "body": "Yeah, that'd be ok too. I chose to leave the code as it was and do the minimal change (given that we are in the RC cycle)\n",
    "commit": "c3cd3323fbe242504913effb8c56fe230b9a15b8",
    "createdAt": "2015-12-17T16:54:16Z",
    "diffHunk": "@@ -99,7 +99,7 @@ private[mesos] class MesosSubmitRequestServlet(\n     // cause spark-submit script to look for files in SPARK_HOME instead.\n     // We only need the ability to specify where to find spark-submit script\n     // which user can user spark.executor.home or spark.home configurations.\n-    val environmentVariables = request.environmentVariables.filter(!_.equals(\"SPARK_HOME\"))\n+    val environmentVariables = request.environmentVariables.filterKeys(!_.equals(\"SPARK_HOME\"))",
    "line": 5
  }, {
    "author": {
      "login": "mgummelt"
    },
    "body": "This breaks ZK persistence due to https://issues.scala-lang.org/browse/SI-6654\n\nThis line throws a NotSerializable exception: https://github.com/apache/spark/blob/master/core/src/main/scala/org/apache/spark/scheduler/cluster/mesos/MesosClusterScheduler.scala#L166\n\n```\nOffer id: 72f4d1ce-67f7-41b0-95a3-aa6fb208df32-O189, cpu: 3.0, mem: 12995.0\n15/12/17 21:52:44 DEBUG ClientCnxn: Got ping response for sessionid: 0x151b1d1567e0002 after 0ms\n15/12/17 21:52:44 DEBUG nio: created SCEP@2e746d70{l(/10.0.6.166:41456)<->r(/10.0.0.240:17386),s=0,open=true,ishut=false,oshut=false,rb=false,wb=false,w=true,i=0}-{AsyncHttpConnection@5dbcebe3,g=HttpGenerator{s=0,h=-1,b=-1,c=-1},p=HttpParser{s=-14,l=0,c=0},r=0}\n15/12/17 21:52:44 DEBUG HttpParser: filled 1591/1591\n15/12/17 21:52:44 DEBUG Server: REQUEST /v1/submissions/create on AsyncHttpConnection@5dbcebe3,g=HttpGenerator{s=0,h=-1,b=-1,c=-1},p=HttpParser{s=2,l=2,c=1174},r=1\n15/12/17 21:52:44 DEBUG ContextHandler: scope null||/v1/submissions/create @ o.s.j.s.ServletContextHandler{/,null}\n15/12/17 21:52:44 DEBUG ContextHandler: context=||/v1/submissions/create @ o.s.j.s.ServletContextHandler{/,null}\n15/12/17 21:52:44 DEBUG ServletHandler: servlet |/v1/submissions/create|null -> org.apache.spark.deploy.rest.mesos.MesosSubmitRequestServlet-368e091\n15/12/17 21:52:44 DEBUG ServletHandler: chain=null\n15/12/17 21:52:44 WARN ServletHandler: /v1/submissions/create\njava.io.NotSerializableException: scala.collection.immutable.MapLike$$anon$1\n    at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1183)\n    at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1547)\n    at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1508)\n    at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1431)\n    at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1177)\n    at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1547)\n    at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1508)\n    at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1431)\n    at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1177)\n    at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:347)\n    at org.apache.spark.util.Utils$.serialize(Utils.scala:83)\n    at org.apache.spark.scheduler.cluster.mesos.ZookeeperMesosClusterPersistenceEngine.persist(MesosClusterPersistenceEngine.scala:110)\n    at org.apache.spark.scheduler.cluster.mesos.MesosClusterScheduler.submitDriver(MesosClusterScheduler.scala:166)\n    at org.apache.spark.deploy.rest.mesos.MesosSubmitRequestServlet.handleSubmit(MesosRestServer.scala:132)\n    at org.apache.spark.deploy.rest.SubmitRequestServlet.doPost(RestSubmissionServer.scala:258)\n```\n",
    "commit": "c3cd3323fbe242504913effb8c56fe230b9a15b8",
    "createdAt": "2015-12-17T22:27:52Z",
    "diffHunk": "@@ -99,7 +99,7 @@ private[mesos] class MesosSubmitRequestServlet(\n     // cause spark-submit script to look for files in SPARK_HOME instead.\n     // We only need the ability to specify where to find spark-submit script\n     // which user can user spark.executor.home or spark.home configurations.\n-    val environmentVariables = request.environmentVariables.filter(!_.equals(\"SPARK_HOME\"))\n+    val environmentVariables = request.environmentVariables.filterKeys(!_.equals(\"SPARK_HOME\"))",
    "line": 5
  }, {
    "author": {
      "login": "dragos"
    },
    "body": "Good catch, @mgummelt. This is a minefield... :(\n",
    "commit": "c3cd3323fbe242504913effb8c56fe230b9a15b8",
    "createdAt": "2015-12-18T09:33:06Z",
    "diffHunk": "@@ -99,7 +99,7 @@ private[mesos] class MesosSubmitRequestServlet(\n     // cause spark-submit script to look for files in SPARK_HOME instead.\n     // We only need the ability to specify where to find spark-submit script\n     // which user can user spark.executor.home or spark.home configurations.\n-    val environmentVariables = request.environmentVariables.filter(!_.equals(\"SPARK_HOME\"))\n+    val environmentVariables = request.environmentVariables.filterKeys(!_.equals(\"SPARK_HOME\"))",
    "line": 5
  }, {
    "author": {
      "login": "andrewor14"
    },
    "body": "FYI for those who are following, this is fixed in #10366\n",
    "commit": "c3cd3323fbe242504913effb8c56fe230b9a15b8",
    "createdAt": "2015-12-19T00:17:24Z",
    "diffHunk": "@@ -99,7 +99,7 @@ private[mesos] class MesosSubmitRequestServlet(\n     // cause spark-submit script to look for files in SPARK_HOME instead.\n     // We only need the ability to specify where to find spark-submit script\n     // which user can user spark.executor.home or spark.home configurations.\n-    val environmentVariables = request.environmentVariables.filter(!_.equals(\"SPARK_HOME\"))\n+    val environmentVariables = request.environmentVariables.filterKeys(!_.equals(\"SPARK_HOME\"))",
    "line": 5
  }],
  "prId": 10359
}]