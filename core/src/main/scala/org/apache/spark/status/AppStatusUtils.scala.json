[{
  "comments": [{
    "author": {
      "login": "vanzin"
    },
    "body": "`task.duration.isDefined` should be redundant now, right?\r\n\r\n(I remember the duration didn't use to be set for running tasks, so this code worked, but apparently it changed while I worked on these changes...)",
    "commit": "7889fb0e5e4515ade35c2a07703017e16ee6194a",
    "createdAt": "2018-02-05T18:27:07Z",
    "diffHunk": "@@ -17,16 +17,23 @@\n \n package org.apache.spark.status\n \n-import org.apache.spark.status.api.v1.{TaskData, TaskMetrics}\n+import org.apache.spark.status.api.v1.TaskData\n \n private[spark] object AppStatusUtils {\n \n+  private val TASK_FINISHED_STATES = Set(\"FAILED\", \"KILLED\", \"SUCCESS\")\n+\n+  private def isTaskFinished(task: TaskData): Boolean = {\n+    TASK_FINISHED_STATES.contains(task.status)\n+  }\n+\n   def schedulerDelay(task: TaskData): Long = {\n-    if (task.taskMetrics.isDefined && task.duration.isDefined) {\n+    if (isTaskFinished(task) && task.taskMetrics.isDefined && task.duration.isDefined) {",
    "line": 17
  }, {
    "author": {
      "login": "cloud-fan"
    },
    "body": "Logically `duration` should be set for running tasks, to indicate how long a task has been run.\r\n\r\nI feel it's safer to keep `task.duration.isDefined`, as we call `task.duration.get` below.",
    "commit": "7889fb0e5e4515ade35c2a07703017e16ee6194a",
    "createdAt": "2018-02-06T03:53:59Z",
    "diffHunk": "@@ -17,16 +17,23 @@\n \n package org.apache.spark.status\n \n-import org.apache.spark.status.api.v1.{TaskData, TaskMetrics}\n+import org.apache.spark.status.api.v1.TaskData\n \n private[spark] object AppStatusUtils {\n \n+  private val TASK_FINISHED_STATES = Set(\"FAILED\", \"KILLED\", \"SUCCESS\")\n+\n+  private def isTaskFinished(task: TaskData): Boolean = {\n+    TASK_FINISHED_STATES.contains(task.status)\n+  }\n+\n   def schedulerDelay(task: TaskData): Long = {\n-    if (task.taskMetrics.isDefined && task.duration.isDefined) {\n+    if (isTaskFinished(task) && task.taskMetrics.isDefined && task.duration.isDefined) {",
    "line": 17
  }],
  "prId": 20493
}]