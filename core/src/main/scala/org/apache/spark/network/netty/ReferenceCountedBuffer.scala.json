[{
  "comments": [{
    "author": {
      "login": "dcapwell"
    },
    "body": "Could make this class a value class.  Based off this patch, the runtime wouldn't have ReferenceCountedBuffer objects created.\n",
    "commit": "f9214216fe33e365375a071e522cc915be8acd67",
    "createdAt": "2014-08-12T18:47:44Z",
    "diffHunk": "@@ -17,15 +17,25 @@\n \n package org.apache.spark.network.netty\n \n-import io.netty.channel.ChannelInitializer\n-import io.netty.channel.socket.SocketChannel\n-import io.netty.handler.codec.string.StringEncoder\n+import java.io.InputStream\n+import java.nio.ByteBuffer\n \n+import io.netty.buffer.{ByteBufInputStream, ByteBuf}\n \n-class FileClientChannelInitializer(handler: FileClientHandler)\n-  extends ChannelInitializer[SocketChannel] {\n \n-  def initChannel(channel: SocketChannel) {\n-    channel.pipeline.addLast(\"encoder\", new StringEncoder).addLast(\"handler\", handler)\n-  }\n+/**\n+ * A buffer abstraction based on Netty's ByteBuf.\n+ *\n+ * The buffer's life cycle is NOT managed by the JVM, and thus requiring explicit declaration of\n+ * reference by the retain method and release method.\n+ */\n+class ReferenceCountedBuffer(underlying: ByteBuf) {"
  }, {
    "author": {
      "login": "rxin"
    },
    "body": "good idea\n",
    "commit": "f9214216fe33e365375a071e522cc915be8acd67",
    "createdAt": "2014-08-12T20:22:54Z",
    "diffHunk": "@@ -17,15 +17,25 @@\n \n package org.apache.spark.network.netty\n \n-import io.netty.channel.ChannelInitializer\n-import io.netty.channel.socket.SocketChannel\n-import io.netty.handler.codec.string.StringEncoder\n+import java.io.InputStream\n+import java.nio.ByteBuffer\n \n+import io.netty.buffer.{ByteBufInputStream, ByteBuf}\n \n-class FileClientChannelInitializer(handler: FileClientHandler)\n-  extends ChannelInitializer[SocketChannel] {\n \n-  def initChannel(channel: SocketChannel) {\n-    channel.pipeline.addLast(\"encoder\", new StringEncoder).addLast(\"handler\", handler)\n-  }\n+/**\n+ * A buffer abstraction based on Netty's ByteBuf.\n+ *\n+ * The buffer's life cycle is NOT managed by the JVM, and thus requiring explicit declaration of\n+ * reference by the retain method and release method.\n+ */\n+class ReferenceCountedBuffer(underlying: ByteBuf) {"
  }],
  "prId": 1907
}]