[{
  "comments": [{
    "author": {
      "login": "vanzin"
    },
    "body": "This doesn't look correct. If I look at the log file for this app (`core/src/test/resources/spark-events/app-20161115172038-0000`), there's a log start event:\r\n\r\n```\r\n{\"Event\":\"SparkListenerLogStart\",\"Spark Version\":\"2.1.0-SNAPSHOT\"}\r\n```\r\n\r\nSo this value should be `\"2.1.0-SNAPSHOT\"`, no?",
    "commit": "93e7a20047ba6b94da894d64c03e58cd70adf0e5",
    "createdAt": "2017-05-04T23:37:13Z",
    "diffHunk": "@@ -22,6 +23,7 @@\n     \"duration\" : 101795,\n     \"sparkUser\" : \"jose\",\n     \"completed\" : true,\n+    \"appSparkVersion\" : \"\","
  }, {
    "author": {
      "login": "redsanket"
    },
    "body": "I am not sure the if the tests hit this code path https://github.com/apache/spark/pull/17658/files#diff-a7befb99e7bd7e3ab5c46c2568aa5b3eR474, so they take the default value",
    "commit": "93e7a20047ba6b94da894d64c03e58cd70adf0e5",
    "createdAt": "2017-05-05T01:38:23Z",
    "diffHunk": "@@ -22,6 +23,7 @@\n     \"duration\" : 101795,\n     \"sparkUser\" : \"jose\",\n     \"completed\" : true,\n+    \"appSparkVersion\" : \"\","
  }, {
    "author": {
      "login": "redsanket"
    },
    "body": "probably I could change the default value, ok will do it",
    "commit": "93e7a20047ba6b94da894d64c03e58cd70adf0e5",
    "createdAt": "2017-05-05T02:27:24Z",
    "diffHunk": "@@ -22,6 +23,7 @@\n     \"duration\" : 101795,\n     \"sparkUser\" : \"jose\",\n     \"completed\" : true,\n+    \"appSparkVersion\" : \"\","
  }, {
    "author": {
      "login": "vanzin"
    },
    "body": "It's not really about the default value; these tests replay the log files, which contain the Spark version, so I would expect the data retrieved through the API to contain the version that was recorded in the event log.\r\n\r\nAnother way of saying that probably there's a bug somewhere in your code that is preventing the data from the event log from being exposed correctly through the REST API.",
    "commit": "93e7a20047ba6b94da894d64c03e58cd70adf0e5",
    "createdAt": "2017-05-05T04:11:22Z",
    "diffHunk": "@@ -22,6 +23,7 @@\n     \"duration\" : 101795,\n     \"sparkUser\" : \"jose\",\n     \"completed\" : true,\n+    \"appSparkVersion\" : \"\","
  }, {
    "author": {
      "login": "redsanket"
    },
    "body": "I see events being passed to ApplicationEventListener in debug logs but interestingly I doPostEvent seems to be not posting events to the listener to listen to the event which is a bit odd, not sure I need to add a change in contract for the tests to pick this up though\r\n\r\n17/05/05 16:39:42.235 qtp1618269752-1127 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.jobs.JobProgressListener@53e58df ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:42.235 qtp1618269752-1127 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.env.EnvironmentListener@53371e87 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:42.235 qtp1618269752-1127 INFO ReplayListenerBus: listener --- event org.apache.spark.storage.StorageStatusListener@394665e7 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:42.235 qtp1618269752-1127 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.exec.ExecutorsListener@2d92f38e ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:42.235 qtp1618269752-1127 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.storage.StorageListener@5a9dbe43 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:42.235 qtp1618269752-1127 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.scope.RDDOperationGraphListener@31b550b1 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:42.236 qtp1618269752-1127 INFO ReplayListenerBus: listener --- event org.apache.spark.scheduler.ApplicationEventListener@3b56723d ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:43.300 qtp1618269752-1126 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.jobs.JobProgressListener@3647a865 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:43.300 qtp1618269752-1126 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.env.EnvironmentListener@4357e8cc ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:43.300 qtp1618269752-1126 INFO ReplayListenerBus: listener --- event org.apache.spark.storage.StorageStatusListener@5062f4c0 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:43.300 qtp1618269752-1126 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.exec.ExecutorsListener@273c097f ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:43.300 qtp1618269752-1126 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.storage.StorageListener@2c33997d ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:43.300 qtp1618269752-1126 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.scope.RDDOperationGraphListener@505e15bf ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:43.300 qtp1618269752-1126 INFO ReplayListenerBus: listener --- event org.apache.spark.scheduler.ApplicationEventListener@175d3f80 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:44.305 qtp1618269752-1131 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.jobs.JobProgressListener@71dacceb ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:44.305 qtp1618269752-1131 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.env.EnvironmentListener@6f41235c ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:44.305 qtp1618269752-1131 INFO ReplayListenerBus: listener --- event org.apache.spark.storage.StorageStatusListener@3cdcb6d0 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:44.305 qtp1618269752-1131 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.exec.ExecutorsListener@4abcd5c6 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:44.305 qtp1618269752-1131 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.storage.StorageListener@6d26f5ee ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:44.305 qtp1618269752-1131 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.scope.RDDOperationGraphListener@b1b60d5 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:44.305 qtp1618269752-1131 INFO ReplayListenerBus: listener --- event org.apache.spark.scheduler.ApplicationEventListener@52283d50 ---SparkListenerLogStart(2.3.0-SNAPSHOT)\r\n17/05/05 16:39:44.676 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.jobs.JobProgressListener@f1563e7 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.676 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.env.EnvironmentListener@9122315 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.676 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.storage.StorageStatusListener@eb98c21 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.676 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.exec.ExecutorsListener@1da79f75 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.676 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.storage.StorageListener@3989cd7d ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.676 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.scope.RDDOperationGraphListener@219b4bd2 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.676 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.scheduler.ApplicationEventListener@63811344 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.722 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.jobs.JobProgressListener@52177d75 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.722 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.env.EnvironmentListener@72409b15 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.722 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.storage.StorageStatusListener@5ee11505 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.722 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.exec.ExecutorsListener@24bad915 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.722 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.storage.StorageListener@4d2fe422 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.723 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.ui.scope.RDDOperationGraphListener@3bc156a1 ---SparkListenerLogStart(1.4.0-SNAPSHOT)\r\n17/05/05 16:39:44.723 qtp1478318899-1195 INFO ReplayListenerBus: listener --- event org.apache.spark.scheduler.ApplicationEventListener@6d5e35e1 ---SparkListenerLogStart(1.4.0-SNAPSHOT)",
    "commit": "93e7a20047ba6b94da894d64c03e58cd70adf0e5",
    "createdAt": "2017-05-05T22:10:12Z",
    "diffHunk": "@@ -22,6 +23,7 @@\n     \"duration\" : 101795,\n     \"sparkUser\" : \"jose\",\n     \"completed\" : true,\n+    \"appSparkVersion\" : \"\","
  }, {
    "author": {
      "login": "vanzin"
    },
    "body": "I think I know what this is. `FsHistoryProvider` has this code to speed up the log parsing for listings:\r\n\r\n```\r\n  protected def mergeApplicationListing(fileStatus: FileStatus): Unit = {\r\n    val newAttempts = try {\r\n      val eventsFilter: ReplayEventsFilter = { eventString =>\r\n        eventString.startsWith(APPL_START_EVENT_PREFIX) ||\r\n          eventString.startsWith(APPL_END_EVENT_PREFIX)\r\n      }\r\n```\r\n\r\nIt only allows those two events through currently, you probably need to the log start event to that list too.",
    "commit": "93e7a20047ba6b94da894d64c03e58cd70adf0e5",
    "createdAt": "2017-05-05T22:16:12Z",
    "diffHunk": "@@ -22,6 +23,7 @@\n     \"duration\" : 101795,\n     \"sparkUser\" : \"jose\",\n     \"completed\" : true,\n+    \"appSparkVersion\" : \"\","
  }, {
    "author": {
      "login": "redsanket"
    },
    "body": "ok doPost is posting the events\r\n7/05/05 17:17:17.265 qtp927704210-1183 INFO ReplayListenerBus: eventInDoPost SparkListenerLogStart(1.4.0-SNAPSHOT) So it should be good, so looks like ApplicationEventListener is not able to read the events, it used to before something has changed will dig deeper",
    "commit": "93e7a20047ba6b94da894d64c03e58cd70adf0e5",
    "createdAt": "2017-05-05T22:19:31Z",
    "diffHunk": "@@ -22,6 +23,7 @@\n     \"duration\" : 101795,\n     \"sparkUser\" : \"jose\",\n     \"completed\" : true,\n+    \"appSparkVersion\" : \"\","
  }, {
    "author": {
      "login": "redsanket"
    },
    "body": "aah ok the UI will work because it is replaying but the rest end point would break as it is not allowing it to pass through, thanks @vanzin ",
    "commit": "93e7a20047ba6b94da894d64c03e58cd70adf0e5",
    "createdAt": "2017-05-05T22:23:52Z",
    "diffHunk": "@@ -22,6 +23,7 @@\n     \"duration\" : 101795,\n     \"sparkUser\" : \"jose\",\n     \"completed\" : true,\n+    \"appSparkVersion\" : \"\","
  }],
  "prId": 17658
}]