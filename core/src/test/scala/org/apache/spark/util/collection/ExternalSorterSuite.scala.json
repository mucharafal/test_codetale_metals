[{
  "comments": [{
    "author": {
      "login": "andrewor14"
    },
    "body": "does this actually run the case that you modified? (i.e. did this modified test fail before your fix?)\n",
    "commit": "2924b93b0d16e98fb045138e2bc0f8d94b1e0bfa",
    "createdAt": "2015-04-28T19:50:49Z",
    "diffHunk": "@@ -506,7 +506,10 @@ class ExternalSorterSuite extends FunSuite with LocalSparkContext with PrivateMe\n     val agg = new Aggregator[Int, Int, Int](i => i, (i, j) => i + j, (i, j) => i + j)\n     val ord = implicitly[Ordering[Int]]\n     val sorter = new ExternalSorter(Some(agg), Some(new HashPartitioner(3)), Some(ord), None)\n-    sorter.insertAll((0 until 100000).iterator.map(i => (i / 2, i)))\n+\n+    // avoid combine before spill\n+    sorter.insertAll((0 until 50000).iterator.map(i => (i , 2 * i)))\n+    sorter.insertAll((0 until 50000).iterator.map(i => (i, 2 * i + 1)))",
    "line": 8
  }, {
    "author": {
      "login": "chouqin"
    },
    "body": "Yes, it failed on my computer(this testcase didn't stop). I set the memory limit to a small value  on my computer to ganrantee spills. I think we can also set `spark.shuffle.memoryFraction` to a small value to do this. The origin value of `spark.shuffle.memoryFraction` is 0.001, I don't know if it can ganrantee spills. If not, we should change it to a smaller value.\n",
    "commit": "2924b93b0d16e98fb045138e2bc0f8d94b1e0bfa",
    "createdAt": "2015-04-29T01:29:02Z",
    "diffHunk": "@@ -506,7 +506,10 @@ class ExternalSorterSuite extends FunSuite with LocalSparkContext with PrivateMe\n     val agg = new Aggregator[Int, Int, Int](i => i, (i, j) => i + j, (i, j) => i + j)\n     val ord = implicitly[Ordering[Int]]\n     val sorter = new ExternalSorter(Some(agg), Some(new HashPartitioner(3)), Some(ord), None)\n-    sorter.insertAll((0 until 100000).iterator.map(i => (i / 2, i)))\n+\n+    // avoid combine before spill\n+    sorter.insertAll((0 until 50000).iterator.map(i => (i , 2 * i)))\n+    sorter.insertAll((0 until 50000).iterator.map(i => (i, 2 * i + 1)))",
    "line": 8
  }],
  "prId": 5737
}]