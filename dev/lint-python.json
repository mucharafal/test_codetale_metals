[{
  "comments": [{
    "author": {
      "login": "gsemet"
    },
    "body": "Note: here I leave the virtualenv of the current environment. tell me if which solution you prefere:\n- jump into a custom venv? (this proposal)\n- fail if in a virtualenv\n- only warn the user if already in a virtualenv\n- no warning at all, the user knows what he/she does\n",
    "commit": "215b7b34170f112c4448fba98b02a50dbb19b2a7",
    "createdAt": "2016-09-05T16:25:04Z",
    "diffHunk": "@@ -26,30 +67,26 @@ PYLINT_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/pylint-report.txt\"\n PYLINT_INSTALL_INFO=\"$SPARK_ROOT_DIR/dev/pylint-info.txt\"\n SPHINXBUILD=${SPHINXBUILD:=sphinx-build}\n SPHINX_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/sphinx-report.txt\"\n+VIRTUALENV_EXEC=\"virtualenv\"\n+\n+# It is a good practice to upgrade pip to the latest version, however, sometimes it might break\n+# something. Let freeze this version here. We cannot put it into requirements.txt since the\n+# execution of this requirement files might depends on the pip version.\n+PIP_VERSION=\"8.1.2\"\n \n cd \"$SPARK_ROOT_DIR\"\n \n+echo \"Jumping into virtualenv $VIRTUAL_ENV_DIR...\"\n+$VIRTUALENV_EXEC $VIRTUAL_ENV_DIR || exit 1"
  }, {
    "author": {
      "login": "holdenk"
    },
    "body": "I think if we _do_ jump to a custom virtual env for syntax checking we should at least restore the users existing virtual env after.\n",
    "commit": "215b7b34170f112c4448fba98b02a50dbb19b2a7",
    "createdAt": "2016-09-09T06:13:26Z",
    "diffHunk": "@@ -26,30 +67,26 @@ PYLINT_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/pylint-report.txt\"\n PYLINT_INSTALL_INFO=\"$SPARK_ROOT_DIR/dev/pylint-info.txt\"\n SPHINXBUILD=${SPHINXBUILD:=sphinx-build}\n SPHINX_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/sphinx-report.txt\"\n+VIRTUALENV_EXEC=\"virtualenv\"\n+\n+# It is a good practice to upgrade pip to the latest version, however, sometimes it might break\n+# something. Let freeze this version here. We cannot put it into requirements.txt since the\n+# execution of this requirement files might depends on the pip version.\n+PIP_VERSION=\"8.1.2\"\n \n cd \"$SPARK_ROOT_DIR\"\n \n+echo \"Jumping into virtualenv $VIRTUAL_ENV_DIR...\"\n+$VIRTUALENV_EXEC $VIRTUAL_ENV_DIR || exit 1"
  }, {
    "author": {
      "login": "gsemet"
    },
    "body": "What do you mean with \"after\"? For the Sphinx build? I think we can do both in this virtual env, this would allow to build without having to do sudo pip install Sphinx-build.\nAnd we can control precisely the version of sphinx in this requirements.txt\n\nIn anyway, this virtualenv will be left automatically at the end of the execution of this script.\n",
    "commit": "215b7b34170f112c4448fba98b02a50dbb19b2a7",
    "createdAt": "2016-09-09T06:48:16Z",
    "diffHunk": "@@ -26,30 +67,26 @@ PYLINT_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/pylint-report.txt\"\n PYLINT_INSTALL_INFO=\"$SPARK_ROOT_DIR/dev/pylint-info.txt\"\n SPHINXBUILD=${SPHINXBUILD:=sphinx-build}\n SPHINX_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/sphinx-report.txt\"\n+VIRTUALENV_EXEC=\"virtualenv\"\n+\n+# It is a good practice to upgrade pip to the latest version, however, sometimes it might break\n+# something. Let freeze this version here. We cannot put it into requirements.txt since the\n+# execution of this requirement files might depends on the pip version.\n+PIP_VERSION=\"8.1.2\"\n \n cd \"$SPARK_ROOT_DIR\"\n \n+echo \"Jumping into virtualenv $VIRTUAL_ENV_DIR...\"\n+$VIRTUALENV_EXEC $VIRTUAL_ENV_DIR || exit 1"
  }, {
    "author": {
      "login": "holdenk"
    },
    "body": "Using the virtualenv for the sphinx build sounds reasonable if we are already doing it for pep8. I was thinking that since we explicitly leave the current virtual env if the user is in one we should try and restore it after the script has been run - but if that already happens automatically thats great.\n",
    "commit": "215b7b34170f112c4448fba98b02a50dbb19b2a7",
    "createdAt": "2016-09-09T06:53:27Z",
    "diffHunk": "@@ -26,30 +67,26 @@ PYLINT_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/pylint-report.txt\"\n PYLINT_INSTALL_INFO=\"$SPARK_ROOT_DIR/dev/pylint-info.txt\"\n SPHINXBUILD=${SPHINXBUILD:=sphinx-build}\n SPHINX_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/sphinx-report.txt\"\n+VIRTUALENV_EXEC=\"virtualenv\"\n+\n+# It is a good practice to upgrade pip to the latest version, however, sometimes it might break\n+# something. Let freeze this version here. We cannot put it into requirements.txt since the\n+# execution of this requirement files might depends on the pip version.\n+PIP_VERSION=\"8.1.2\"\n \n cd \"$SPARK_ROOT_DIR\"\n \n+echo \"Jumping into virtualenv $VIRTUAL_ENV_DIR...\"\n+$VIRTUALENV_EXEC $VIRTUAL_ENV_DIR || exit 1"
  }, {
    "author": {
      "login": "gsemet"
    },
    "body": "Actually I'm thinking it may be better not to leave virtualenv if we are inside one. So we don't have this copy paste of the code for desactivating it.\nWhat do you think?\n",
    "commit": "215b7b34170f112c4448fba98b02a50dbb19b2a7",
    "createdAt": "2016-09-09T06:57:59Z",
    "diffHunk": "@@ -26,30 +67,26 @@ PYLINT_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/pylint-report.txt\"\n PYLINT_INSTALL_INFO=\"$SPARK_ROOT_DIR/dev/pylint-info.txt\"\n SPHINXBUILD=${SPHINXBUILD:=sphinx-build}\n SPHINX_REPORT_PATH=\"$SPARK_ROOT_DIR/dev/sphinx-report.txt\"\n+VIRTUALENV_EXEC=\"virtualenv\"\n+\n+# It is a good practice to upgrade pip to the latest version, however, sometimes it might break\n+# something. Let freeze this version here. We cannot put it into requirements.txt since the\n+# execution of this requirement files might depends on the pip version.\n+PIP_VERSION=\"8.1.2\"\n \n cd \"$SPARK_ROOT_DIR\"\n \n+echo \"Jumping into virtualenv $VIRTUAL_ENV_DIR...\"\n+$VIRTUALENV_EXEC $VIRTUAL_ENV_DIR || exit 1"
  }],
  "prId": 14963
}, {
  "comments": [{
    "author": {
      "login": "holdenk"
    },
    "body": "Wait even simpler[ish] - do we need to deactivate the old env or will activating the new env be enough (provided we store the old VIRTUAL_ENV path to restore to after we deactivate).\n",
    "commit": "215b7b34170f112c4448fba98b02a50dbb19b2a7",
    "createdAt": "2016-09-09T06:14:22Z",
    "diffHunk": "@@ -17,6 +17,47 @@\n # limitations under the License.\n #\n \n+VIRTUAL_ENV_DIR=\"build/venv\"\n+if [[ ! -z $VIRTUAL_ENV ]]; then\n+    echo \"We are in the following virtualenv: $VIRTUAL_ENV. Leaving it...\"\n+    # Cannot call \"deactivate\" from a bash script, copy/paste the code from virtualenv 'activate'"
  }, {
    "author": {
      "login": "gsemet"
    },
    "body": "I am open to suggestion. If we are already inside a venv we can expect the user knows what it does and don't desactivate it.\n",
    "commit": "215b7b34170f112c4448fba98b02a50dbb19b2a7",
    "createdAt": "2016-09-09T06:51:09Z",
    "diffHunk": "@@ -17,6 +17,47 @@\n # limitations under the License.\n #\n \n+VIRTUAL_ENV_DIR=\"build/venv\"\n+if [[ ! -z $VIRTUAL_ENV ]]; then\n+    echo \"We are in the following virtualenv: $VIRTUAL_ENV. Leaving it...\"\n+    # Cannot call \"deactivate\" from a bash script, copy/paste the code from virtualenv 'activate'"
  }],
  "prId": 14963
}]