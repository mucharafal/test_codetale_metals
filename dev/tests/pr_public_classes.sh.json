[{
  "comments": [{
    "author": {
      "login": "nchammas"
    },
    "body": "Huh... I didn't know you could do that.\n\nI was aware of strange hiccups in the old logic but never figured it out. I guess this change makes the comment \"diff against master from branch point\" actually true now.\n",
    "commit": "dc8d552881a8c0c4ac5a6c7fdac8fd4408911f77",
    "createdAt": "2015-12-23T20:24:30Z",
    "diffHunk": "@@ -24,36 +24,44 @@\n #\n # Arg1: The Github Pull Request Actual Commit\n #+ known as `ghprbActualCommit` in `run-tests-jenkins`\n-# Arg2: The SHA1 hash\n-#+ known as `sha1` in `run-tests-jenkins`\n-#\n-\n-# We diff master...$ghprbActualCommit because that gets us changes introduced in the PR\n-#+ and not anything else added to master since the PR was branched.\n \n ghprbActualCommit=\"$1\"\n-sha1=\"$2\"\n+\n+# $ghprbActualCommit is an automatic merge commit generated by GitHub; its parents are some Spark\n+# master commit and the tip of the pull request branch.\n+\n+# By diffing$ghprbActualCommit^...$ghprbActualCommit and filtering to examine the diffs of only\n+# non-test files, we can gets us changes introduced in the PR and not anything else added to master\n+# since the PR was branched.\n+\n+# Handle differences between GNU and BSD sed\n+if [[ $(uname) == \"Darwin\" ]]; then\n+    SED='sed -E'\n+else\n+    SED='sed -r'\n+fi\n \n source_files=$(\n-  git diff master...$ghprbActualCommit --name-only  `# diff patch against master from branch point` \\\n+  git diff $ghprbActualCommit^...$ghprbActualCommit --name-only  `# diff patch against master from branch point` \\\n     | grep -v -e \"\\/test\"                               `# ignore files in test directories` \\\n     | grep -e \"\\.py$\" -e \"\\.java$\" -e \"\\.scala$\"        `# include only code files` \\\n     | tr \"\\n\" \" \"\n )\n+\n new_public_classes=$(\n-  git diff master...$ghprbActualCommit ${source_files}      `# diff patch against master from branch point` \\\n+  git diff $ghprbActualCommit^...$ghprbActualCommit ${source_files}      `# diff patch against master from branch point` \\",
    "line": 38
  }],
  "prId": 10455
}]